**系统管理**


# 系统配置
在左侧菜单栏选择「系统管理」-「系统配置」，进入「概况」页面：


## 用户登录类型
可配置多种登录方式，包括： 本地登录， 直接使用SmartCMP配置的用户名和密码登录。
 ### LDAP/Microsoft Active Directory

+ 不论大小企业，无论企业性质，都需要一个集中式的帐号管理系统，员工只需要设置一次帐号密码，就可以方便地使用各个不同的系统。(例如：行政层面的OA系统、邮件系统、会议室预订系统等等。研发团队内部又可能有代码管理、项目进度管理、Bug追踪、依赖管理、Wiki等等。）

+ 当选用经典的LDAP (Lightweight Directory Access Protocol)作为帐号管理服务器，LDAP是一个开放的，中立的，工业标准的应用协议，通过IP协议提供访问控制和维护分布式信息的目录信息。将OA系统、代码服务器、Jenkins等系统接入LDAP，实现“一套帐号，各系统共享”。

+ 「LDAP配置」中填入：LDAP Connection Name、LDAP URL即LDAP服务器地址、 Base DN、ROOT DN、Password

+ 配置完成之后，在LDAP的登录UI中，输入 LDAP的 uid／password, 进行登录，验证成功之后，可以进入到SmartCMP，但用户在第一次登录后没有任何的权限，管理员给这个User 配置ROLE和BG之后，用户需要重新登录，然后正常进行其它的操作。



### OAuth2

OAuth2 是一个开放授权标准，它允许用户让第三方应用访问该用户在某服务的特定私有资源，但是不提供账号密码信息给第三方应用。例如：用户小明希望通过github账号来登录SmartCMP
下面为您介绍SmartCMP如何使用	OAuth2 登录的具体步骤。

+ 选择登录类型为 OAuth2  进行具体的参数配置，以github为例，获取授权信息：
+ 登陆giuhub，点击个人头像，一次点击 Settings --> Developer Settings --> OAuth，点击 New OAuth App
![github配置](../../picture/Admin/github1.png)

创建成功后如下:
![github配置](../../picture/Admin/github2.png)

+ 配置完成后，在浏览器中输入：http://<服务器域名或地址>端口号/login/oauth2/租户id，将会自动跳转到用户授权页面，输入gitHub用户名和密码，验证通过后直接跳转到SmartCMP平台，以此实现通过github账号来登录SmartCMP的功能需求。

### CAS_SSO

+ 当选择登录方式为 CAS_SSO时，UI界面没有任何配置信息，后台会提前配置，具体配置方法请咨询交付工程师。
+ 用户的访问方式：SmartCMP的每个租户在对接Cas的时候需要使用每个租户定制的登录方式, 例如: 租户 "default", 那么Cas的登录地址就是 custlogin/cas/default， 在浏览器下输入，http://192.168.12.34/custlogin/cas/default , 就是cas的登录方式，后缀“default”，是当前租户的id。在实际常见中，default替换为实际id，ip(192.168.12.34)以实际ip为准




## DNS配置
如果需要配置和发布DNS服务，请在此处设置DNS根域名，并在资源池中根据不同环境的需要设置子域名，从而在服务配置中进行选择

+ DNS域（OpenStack）	新增DNS域，可新增一个或多个（选填）
+ 域名由根域名、顶级域、二级、三级等多级域名构成，每级域名由字母、数字和连字符(-)构成(第一个字符不能是连字符)，不区分大小写，长度不超过63个字符。一个完整域名总长度不超过255个字符，必须以点结尾。配置成功后，可在OpenStack资源池中配置二级、三级域名。


>「Note」DNS域名需在DNS服务器上配置，如无，在申请服务时将报错


# 界面配置{#界面配置}

通过"「系统配置」-「界面配置」"来确定品牌和服务申请信息包括，配色、页眉、浏览器标签、登录页面、关于页面和是否显示帮助文档，以及调整服务目录的显示方式。

配置品牌的具体步骤：
选择亮色系或暗色系风格，控制左边导航栏区域的配色风格；
可选择是否隐藏页面，当选择不隐藏时，使用调色面板选择页面配色和文字颜色，上传图标、自定义文字内容；
上传浏览器图标，自定义浏览器标题；
上传登录页面背景图片，定义登录页左边文字，自定义文字样式，文字支持使用Markdown 语法格式；
可选择是否隐藏关于页面，当选择不隐藏时，上传图片，定义产品名称和版权声明；
定义是否显示帮助文档，选择隐藏时，导航栏右上角的问号按钮将被隐藏。



配置服务申请的具体步骤：目前服务目录支持2种视图。在「服务申请」标签页，

+ 租户管理员可以配置 在服务目录中，分组与服务的展现方式：标签页展示或层级展示

+ 具体展现方式：标签页展示：即分组按照标签页展示。层级展示的方式，按照卡片的模式，先展示服务分组,服务分组的具体操作步骤，请参考：[服务分组](https://cloudchef.github.io/doc/AdminDoc/05服务建模/服务分组.html) 在服务目录视图界面，可查看服务分组的图标、名称、描述和文件夹的显示方式，点击一个分组，展现此服务分组的所有卡片。


# 资源标签{#资源标签}
标签核心功能是自动匹配资源，快速选择资源以及利用标签一键搜索，快速筛选。
添加标签的具体步骤：点击左侧导航栏 「系统管理」 - 「资源标签」，管理员有配置标签和定义标签的参数的权限。
+ 配置资源标签的「基本信息」：名称（一般配置中文，比如环境）、主键（只能输入英文和数字，比如env，作为标识位）、描述、顺序（定义标签选择的顺序）选择类型（单选/多选，指定做筛选时，标签选择值集的方式），指定的资源类型：云资源（例如：资源池）、存储资源（例如：vSphere的数据存储，OpenStack的存储类型）、网络资源。注意：同一个资源池可以设置多个标签，例如：可以给同一个vSphere资源池的存储或网络资源，分别选择使不同的标签。


+ 配置资源标签的「值集」例如：当key是环境，支持创建值value时，支持添加一个值集（例如：生产环境），也支持添加多个值集（例如：生产环境、测试环境、开发环境）并且每个值需要配置名称， 主键（可以用于命名规则），以及描述。 
点击保存按钮，资源标签创建完成

使用资源标签

资源标签创建完成之后，将资源池与资源标签进行绑定，具体操作步骤：点击左侧导航栏 「基础设施」 - 「资源池管理」在资源标签选择“标签键值”，一个资源池只能选择一个key,能选择一个或多个value, 例如：vSphere资源池,key选定为"环境",选择一个value“开发环境”或多个value“生产环境、测试环境、开发环境”。

资源标签在服务配置中的应用：配置Server或Instance节点的资源池，可供选择的资源池来源于“共享资源池、业务组绑定的资源池”，其中资源标签在选择资源池的作用：
+ 选择手工指定资源池的策略，然后根据选定的资源标签过滤，再进一步根据标签过滤的结果进行选择，选择是否允许在申请时修改或者在审批时修改。例如：vSphere云服务配置Server组件，选择手工指定资源池的策略，选定拥有“开发环境”资源标签的资源池“vSphere开发资源池”，勾选“允许修改”和“仅审批时可改”，则服务配置完成之后，在服务申请时，可再一次选择资源池。

+ 选择“自动选择剩余容量最大、自动选择费用最低、平均分配” 的资源池选择策略，平台将根据策略自动分配，并且自动分配的时候，只能在按照标签过滤出来的资源池当中进行选择。更多服务配置信息请参考：[服务配置](https://cloudchef.github.io/doc/AdminDoc/05服务建模/服务配置.html) 

+ 资源标签在服务申请中的应用：服务配置中配置资源池允许修改，则在申请页面，针对每个key，根据资源池中已经配置的资源标签，只展现资源池中已经使用的value。

>「Note」面对“多个key 并且每个key有多个value”的应用场景。例如，存在两个key,分别为 “环境、性能 ”。key是环境时，下面设有三个value ，分别为“Pro，UAT，Dev”；key是性能时，下面设有三个value 分别为 “高性能，中性能，一般性能” 。两个资源池（vSphere-dev 资源池 和 vSphere-test 资源池），vSphere-dev 资源池有2个标签Pro和高性能，vSphere-test 资源池有2个标签UAT和一般性能, 因此在为节点配置云资源、服务申请页面展示的时候，“环境”下只显示Pro和UAT，“性能”下只显示高性能和一般性能,任意选择其中一个资源标签的value之后，剩余的标签展示要根据第一个资源标签的value的选择进行动态调整。例如：首先选择资源标签的value “ Pro ”，剩余的第二个标签只会出现“高性能”。以此类推，在更多key和更多value的应用场景中，选择逻辑也一致。


# 通知配置

## SMTP配置

进入菜单「系统管理」-「系统配置」，在SMTP配置标签页，用户可以配置当前租户能够访问的SMTP配置。

在SMTP配置中可以填入下列信息：

  基本信息     |说明
  :------------:|: ------------:
  使用SSL     | 当前SMTP是否适用了SSL
  SMTP服务器  | SMTP服务器地址
  端口        | SMTP端口号
  用户名      | 用户名
  密码        | 密码
  发件人      | 默认的邮件发件人

配置完成后，可点击「验证设置」，系统将会根据配置自动发送一封测试邮件到当前账户的邮箱地址，以验证SMTP服务器是否工作。

## SMS配置

进入菜单「系统管理」-「系统配置」，在「SMS配置」标签页中，可以填入当前租户能够访问的SMS（短消息）配置。

  基本信息    |说明
  :---:|:---:
  用户名   |   用户名
  密码      |  密码
  SMS服务器 |  SMS服务器地址
  端口     |   SMS端口

## 企业微信配置

进入菜单「系统管理」-「系统配置」，在「企业微信配置」标签页中，租户管理员可以配置当前租户企业微信的相关信息。

 基本信息 | 说明
  :---:|:---: 
 企业ID | 在企业微信管理后台“我的企业”->“企业信息”下查看
 应用ID | 每一个应用的唯一AgentID，请在企业微信管理后台“应用与小程序”->“应用”下查看
 应用密钥 | 每一个应用都有一个独立的访问密钥，请在企业微信管理后台“应用与小程序”->“应用”下查看

## 钉钉配置
进入菜单「系统管理」-「系统配置」，在「钉钉配置」标签页中，租户管理员可以配置当前租户钉钉的相关信息。

 基本信息 | 说明
  :---:|:---:
 应用ID |创建应用时，系统自动生成的AgentId，可用于发送企业会话消息等场景
 应用Key |创建应用时，与应用Key一起同时由系统自动生成
 应用密钥 |创建应用时，系统自动分配，是应用开发过程中的唯一性标识

# 菜单配置


当您接入第三方系统或扩展系统（如接入百度、京东、Azure账单、仪表盘）时，菜单配置使接入的菜单能够更加灵活。

在菜单配置中您可以定义多种仪表盘，您也可以接入外部系统，并自由灵活的选择扩展菜单，下文为您介绍具体的操作方法。

## 添加菜单配置

菜单配置可定义多种仪表盘和接入多种不同第三方系统，定义好的仪表盘和扩展系统将根据定义的权限分配给不同的角色查看，并根据定义的位置灵活的展现。

1.  点击「系统管理」-「菜单配置」，点击添加，在「添加菜单配置」标签页中，输入名称、描述、类型（选择Metabase代表接入的是仪表盘，选择外部URL为接入第三方系统）、位置、URL参数、角色（选择能够访问此菜单的角色）、状态（选择启用还是禁用该菜单）。

您可以灵活选择扩展菜单的位置，例如:

添加扩展菜单百度，位置选择

-   前于系统管理（系统管理是一级菜单），则百度也是一级菜单在系统管理菜单前面

-   位于系统管理（系统管理是一级菜单），则百度是二级菜单内置在系统管理菜单中

-   后于系统管理（系统管理是一级菜单），则百度也是一级菜单在系统管理菜单后面

2.  点击「提交」，菜单配置列表中显示目前添加的所有仪表盘，显示仪表盘名称、描述、ULR来源、URL参数、角色（可查看该仪表盘的角色）、状态、创建时间等。

## 编辑、删除菜单配置

点击「系统管理」-「菜单配置」，点击编辑，在「编辑菜单配置」标签页中，二次编辑扩展菜单信息。

点击「系统管理」-「菜单配置」，点击删除，即可删除扩展菜单

# 报表配置

报表配置功能为用户提供更多各种类型的报表，形成一个可扩展的报表模块，支持管理员自由灵活地定义报表功能。

+ 在「系统管理」-「报表配置」配置不同角色的报表查看权限，设置报表的状态（启用、禁用），并选择将报表赋予给某角色进行查看，如租户成员、业务组管理员、软件架构师以及自定义角色。

+ 配置完成后，在「资源分析」-「报表」可以查看相应的报表，支持将报表导出为常用的Excel和PDF格式文件。

# 操作审计


支持对用户访问、操作信息的记录，租户管理员和sysadmin默认有该权限，若需要为其他角色增加该权限，
请新增角色并添加该权限，详见[角色](https://cloudchef.github.io/doc/AdminDoc/04组织架构管理/角色.html)

点击左侧导航栏的「系统管理」-「操作审计」，可看到该租户下的操作记录。显示操作的者、操作对象、操作名称、操作参数、状态以及操作时间。可通过「高级搜索」进行快速筛选定位，支持操作者、状态、操作对象、起止时间的筛选，也可以使用普通搜索功能。




# 安全审计

SmartCMP支持用户通过堡垒机访问虚拟机，通过统一的Http请求对各种堡垒机进行调度。核心场景：虚拟机创建好后，将虚拟机注册到堡垒机；虚拟机删除后，将虚拟机从堡垒机中注销；虚拟机变更后，更新堡垒机，例如虚拟机变更了所有者，同步修改堡垒机中虚拟机的注册信息。整合堡垒机和平台的访问控制（平台和堡垒机做权限系统对接，设置用户权限，设定用户是否可以通过SSH或RDP连接虚拟机），并且整合堡垒机的审计功能，包括：操作，命令，包含SSH和RDP的命令，录像回放。
+ 堡垒机入口接入GuacaMole（即Apache Guacamole）堡垒机的具体操作步骤：点击左侧导航栏「安全审计」-「堡垒机」点击添加，填入堡垒机信息，名称(虚拟机名称)、描述、Guacd地址（即堡垒机的URL链接）、Guacd端口（即堡垒机的访问端口），SmartCMP通过Cloudchef-Integration来验证登陆信息是否正确。
+ 堡垒机与资源池进行绑定：点击左侧导航栏「基础设施」-「资源池管理」云平台资源信息标签页，指定已经接入的其中一个堡垒机。例如：在添加vSphere资源池时，绑定堡垒机Guacd，使用vSphere资源池部署的虚拟机将自动注册到堡垒机，使用vSphere资源池部署的虚拟机卸除时自动从堡垒机中取消注册。
+ 堡垒机的使用，vSphere资源池与堡垒机进行绑定之后，使用vSphere资源池部署成功的云主机，点击左侧导航栏「我的部署」-「云主机」-「Web SSH」操作，点击后直接进入web终端，点击时，进行信息刷新（如虚拟机IP地址发生变更，则自动更新堡垒机中的虚拟机的IP地址）。例如：通过web终端修改协议信息的相关参数，例如，修改虚拟机的用户名和密码。
+ 点击「远程终端」操作后能够直接通过 “RDP或VNC” 的方式，按照云主机的配置来打开云平台上的远程终端，

