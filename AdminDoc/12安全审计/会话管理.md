**会话管理**

# 堡垒机的用户轨迹
您可以查看通过堡垒机对云主机的远程访问记录，具体步骤请参考下文：

 + 点击左侧导航栏 会话管理 - 用户轨迹 ，进入活动会话标签页，您可以查看当前正在进行的会话，也可以终止一个或多个会话，点击终止按钮就能断开对应用户的会话。
  
 + 点击历史会话标签页，您可以查看过往所有的会话历史，并了解每个历史会话的详细信息，点击回放按钮就可以查看历史操作录像，点击下载按钮可以查看当次会话中用户所执行的webssh命令，以及执行的结果。
![访问会话](../../picture/Admin/访问会话.PNG)

# 堡垒机命令的过滤
堡垒机提供命令过滤功能。通过使用该功能，您可以设置命令控制策略来管理用户对主机的访问，以保障运维操作的合规、安全、可控。

+ 点击 会话管理 - 命令过滤 ，您可以看到过滤命令的相关信息，包括名称、描述、状态、作用方式、匹配方式、命令规则、过滤目标、作用角色、创建者、创建时间、更新时间等。

+ 您也可以对已添加的命令进行各种操作，包括编辑、删除、启用和禁用等。

下文为您介绍如何新建命令过滤策略。

选择 会话管理 - 命令过滤 ，点击添加按钮，填入以下信息：

  + 基本信息：请填写过滤命令的基本信息
  
   + 过滤命令的名称和描述：请自定义堡垒机命令的名称和描述
  
   + 状态：请选择该命令是启用或者被禁用

   + 作用方式：请设置该命令是否被允许或者拒绝执行，当一条命令既被设定为允许又被设置为拒绝时，此条命令优先被设定为拒绝。
  
   + 匹配方式：请选择该命令的匹配方式，可选“完整匹配”和“正则表达式匹配”
     + 完整匹配：整个字符信息完全匹配成功 
     + 正则表达式匹配：一种字符串匹配的模式，可以用来检查一个字符串是否含有某种子串
  
   + 命令规则：请自定义填写命令规则信息
  
  + 过滤目标：请定义命令生效的云资源，当用户在某个云资源上进行脚本执行的时候，只要该云资源满足下列任意一个条件，平台将对脚本内容做审计，不满足条件的脚本将被拒绝执行。
    + 业务组：请选择云资源所属业务组
    + 项目：请选择云资源所属项目
    + 键值标签：由一个键值对组成，例如键为“环境”且值为“UAT”的标签。
    + 资源类型：云资源类型包括IaaS、PaaS、CaaS、软件和代理。
    + 云资源：请选择命令作用的具体云资源，使该命令在相应云资源上生效。
  
  + 作用角色：请选择该命令作用的角色或者用户。
    + 角色：可选的角色类型包括平台内置的角色（软件架构师、普通成员、基础设施架构师、平台管理员等),您也可以自定义添加角色，具体步骤可参考[角色](https://cloudchef.github.io/doc/AdminDoc/04组织架构管理/角色.html)
    + 用户：可选具体用户，使命令生效。

