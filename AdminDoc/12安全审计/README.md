



# 安全审计

## 堡垒机

SmartCMP支持通过堡垒机访问虚拟机，通过统一的Http请求对各种堡垒机进行调度。

核心使用场景：虚拟机创建好后，将虚拟机注册到堡垒机；虚拟机删除后，将虚拟机从堡垒机中注销；虚拟机变更后，更新堡垒机，例如虚拟机变更了所有者，同步修改堡垒机中虚拟机的注册信息。整合堡垒机和平台的访问控制（平台和堡垒机做权限系统对接，设置用户权限，设定用户是否可以通过SSH或RDP连接虚拟机），并且整合堡垒机的审计功能，包括：操作，命令，包含SSH和RDP的命令，录像回放。

具体配置步骤：
+ 堡垒机入口接入GuacaMole（即Apache Guacamole）堡垒机的具体操作步骤：点击左侧导航栏「安全审计」-「堡垒机」点击添加，填入堡垒机信息，名称(虚拟机名称)、描述、Guacd地址（即堡垒机的URL链接）、Guacd端口（即堡垒机的访问端口），SmartCMP通过Cloudchef-Integration来验证登陆信息是否正确。
+ 堡垒机与资源池进行绑定：点击左侧导航栏「基础设施」-「资源池管理」云平台资源信息标签页，指定已经接入的其中一个堡垒机。例如：在添加vSphere资源池时，绑定堡垒机Guacd，使用vSphere资源池部署的虚拟机将自动注册到堡垒机，使用vSphere资源池部署的虚拟机卸除时自动从堡垒机中取消注册。
+ 堡垒机的使用，vSphere资源池与堡垒机进行绑定之后，使用vSphere资源池部署成功的云主机，点击左侧导航栏「我的部署」-「云主机」-「概况」标签页，选择远程协议类型，包括：基于云平台、RDP或VNC（选择基于RDP或VNC，需要选择远程协议端口），选择完成后，点击「远程终端」操作后能够直接通过 “RDP或VNC” 的方式，按照云主机的配置来打开云平台上的远程终端，可以通过远程终端修改协议信息的相关参数，例如，修改虚拟机的用户名和密码。 


## 备份管理平台

SmartCMP支持基于Veeam实现快速、可靠地备份所有云主机，配置备份管理平台，将资源池和备份管理平台进行绑定，则在这个资源池部署的云主机都可以通过Veeam来进行管理，支持恢复单个文件、整个虚拟机、应用程序等等，确保服务的安全性和高可用性。

核心使用场景：

备份：是一个即时发生的备份（即on demand手工备份）, 点击这个操作, 触发一次备份操作, 备份的参数可能包含备份文件的名字即可, 参数需要配置表单。支持在操作历史中查看备份操作的执行过程和结果（备份成功或是失败）。


恢复：是一个Inplace的恢复, 即在当前的云主机中进行恢复, 但是要求能够选择备份点。（备份点应该是一个列表, 允许用户进行选择, 至少应该出现备份文件的名称, 时间等信息, 点击备份点之后, 触发一次恢复的过程把备份点的数据恢复到当前云主机, 参数需要配置表单）能够在操作历史中查看恢复操作的执行过程和结果（恢复成功或是失败）。
例如：实施从本地数据中心到云端虚拟机复制副本的恢复，备份

具体配置步骤：

+ 备份管理入口配置：点击左侧导航栏「安全审计」-「备份管理平台」点击添加，填入Veeam信息，名称(Veeam系统平台的名称)、描述、Veeam地址（即Veeam平台的URL链接）、用户名和密码（即Veeam平台的登录用户名和密码）

+ 与资源池进行绑定：点击左侧导航栏「基础设施」-「资源池管理」云平台资源信息标签页，指定已经接入的备份管理平台。例如：在添加vSphere资源池时，绑定备份管理平台Veeam，使用vSphere资源池部署的虚拟机将自动关联到Veeam，通过备份管理平台来管理云主机。

+ 备份恢复系统的使用，vSphere资源池与备份管理平台Veeam进行绑定之后，使用vSphere资源池部署成功的云主机，点击左侧导航栏「我的部署」-「云主机」，支持进行基本的「备份」/「恢复」操作。


