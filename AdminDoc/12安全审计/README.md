
**备份与安全**
通过 SmartCMP 云资源可以根据企业内部的组织架构有效的管理和使用起来，同时，SmartCMP也关注如何更安全的使用资源，这里的安全包含两个方面，一个是安全访问和使用资源，一个是数据备份和恢复。

+ 用户通过堡垒机访问虚拟机，助力构建用户、权限、资源管理的无缝对接,既保障云端运维工作权限可管控、操作可审计、合规可遵从，又为用户带来极佳的使用体验。

+ 不仅整合了内置的堡垒机，还支持对接第三方堡垒机，可以为不同的资源池配置不同堡垒机，在部署资源的时候，会根据资源所配置的堡垒机，将资源自动地注册到堡垒机，资源卸除时，将自动与堡垒机解绑，用户无需在安装多余的软件，也无需单独打开多个控制界面。

+ 用户访问远程云主机时，需要经过堡垒机，我们支持基于云平台/RDP/VNC等多种远程协议，提供统一的运维入口、构建安全、高效的运维通道。

+ 提供健全合规的运维审计，包括，运维操作全面记录、操作录像、录像在线回放、追溯运维操作故障、手动中断异常操作等功能。运维人员每次通过 Web SSH 登陆虚拟机进行运维操作，就自动会使用堡垒机的 Web SSH 服务，每次的连接都会生成一个会话记录运维操作，审计人员可以通过实时监控，查看正在运维的会话，如果发现存在违规操作，可手动终止一个或多个会话，也可以通过会话历史查看会话的详细信息，通过录像查看操作的视频记录 。



+ 另外，SmartCMP已经对接了Veeam备份平台，对接了备份平台以后，虚拟机就会多出了“备份和恢复”两个按钮，用户可以按需的，自助的备份单个文件、文件夹、整个虚机、应用程序等。

+ 灵活选择备份点，即可快速恢复备份数据到当前云主机。用户按需对资源进行的备份、恢复操作，将在操作历史中查看执行过程和结果。

至此，通过 CMP 单个控制台，实现堡垒机的使用，云资源备份、恢复管理和自服务，满足组织内部的备份需求，确保服务的安全性和业务连续性，减轻IT人员的负担，降低运维风险。 


下文介绍具体的使用方法。

# 堡垒机{#堡垒机}

SmartCMP支持通过堡垒机访问虚拟机，通过统一的Http请求对各种堡垒机进行调度。

核心使用场景：
+ 权限管理：整合堡垒机和平台的访问控制（平台和堡垒机做权限系统对接，设置用户权限，设定用户是否可以通过SSH或RDP登录云主机的远程桌面。
+ 用户管理：所有用户访问虚拟机，都需要经过堡垒机
+ 运维操作：虚拟机创建好后，将虚拟机注册到堡垒机；虚拟机删除后，将虚拟机从堡垒机中注销；虚拟机变更后，更新堡垒机，例如虚拟机变更了所有者，同步修改堡垒机中虚拟机的注册信息。
+ 会话管理和录像回放：平台还支持堡垒机会话管理功能，当用户通过堡垒机对远程云主机进行运维操作时，会形成实时会话链接，租户管理员可以查看当前正在进行的会话，当发现异常，可以手动终止一个或多个会话，点击终止断开对应用户的会话。还可以查看过往所有的会话历史，了解每个历史会话的详细信息，可以点击回放来查看录像。


具体配置步骤：
+ 接入Guacamole（即Apache Guacamole）堡垒机的具体操作步骤：点击左侧导航栏「备份与安全」-「Guacamole堡垒机」点击添加，填入堡垒机信息，名称(虚拟机名称)、描述、Guacd地址（即堡垒机的URL链接）、Guacd端口（即堡垒机的访问端口），SmartCMP通过Cloudchef-Integration来验证登陆信息是否正确。
> 对接第三方堡垒机，例如：齐治堡垒机，通过「堡垒机入口」来接入，「Guacamole堡垒机」是SmartCMP内嵌的堡垒机管理界面。
+ 堡垒机与资源池进行绑定：点击左侧导航栏「基础设施」-「资源池管理」云平台资源信息标签页，指定已经接入的其中一个堡垒机。例如：在添加vSphere资源池时，绑定堡垒机Guacd，使用vSphere资源池部署的虚拟机将自动注册到堡垒机，使用vSphere资源池部署的虚拟机卸除时自动从堡垒机中取消注册。
+ 堡垒机的使用，vSphere资源池与堡垒机进行绑定之后，使用vSphere资源池部署成功的云主机，点击左侧导航栏「我的部署」-「云主机」-「概况」标签页，选择远程协议类型，包括：基于云平台、RDP或VNC（选择基于RDP或VNC，需要选择远程协议端口），选择完成后，点击「远程终端」操作后能够直接通过 “RDP或VNC” 的方式，按照云主机的配置来打开云平台上的远程终端，可以通过远程终端修改协议信息的相关参数，例如，修改虚拟机的用户名和密码。 
+ 运维人员在云主机的运维操作界面，每次通过 Web SSH 登陆虚拟机进行运维操作，就自动会使用堡垒机的 Web SSH 服务，每次的连接都会生成一个会话记录运维操作， 审计人员点击左侧导航栏「备份与安全」-「Guacamole堡垒机」-活动会话，如果发现违规操作，可手动点击「终止」按钮，可以马上终端会话连接。
+ 点击左侧导航栏「备份与安全」-「Guacamole堡垒机」-历史会话，查看会话的详细信息，包括：主机名、IP地址、协议、Guacd名称、用户名、开始时间、持续时间、操作录像，点击播放即可在线播放操作录像。


# 备份系统{#备份系统}

SmartCMP支持基于Veeam实现快速、可靠地备份vSphere云平台的所有云主机，配置备份管理平台，将资源池和备份管理平台进行绑定，则在这个资源池部署的云主机都可以通过Veeam来进行管理，支持恢复单个文件、整个虚拟机、应用程序等等，确保服务的安全性和高可用性。

核心使用场景：

备份：是一个即时发生的备份（即手工备份）， 点击这个操作， 触发一次备份操作， 备份的参数可能包含备份文件的名字即可， 参数需要配置表单。支持在操作历史中查看备份操作的执行过程和结果（备份成功或是失败）。
例如：将当前整个云主机进行备份，类似于打快照


恢复：即支持选择备份点，在当前的云主机中进行恢复（备份点是一个列表， 允许用户进行选择备份文件的名称， 时间信息，更多额外的参数需要配置表单，点击备份点之后， 触发一次恢复的过程把备份点的数据恢复到当前云主机）能够在操作历史中查看恢复操作的执行过程和结果（恢复成功或是失败）。
例如：实施备份的云主机副本恢复到当前云端虚拟机

具体配置步骤：

+ 备份管理入口配置：点击左侧导航栏「备份与安全」-「备份管理平台」点击添加，填入Veeam信息，名称(Veeam系统平台的名称)、描述、Veeam地址（即Veeam平台的URL链接）、用户名和密码（即Veeam平台的登录用户名和密码）

+ 与资源池进行绑定：点击左侧导航栏「基础设施」-「资源池管理」云平台资源信息标签页，指定已经接入的备份管理平台。例如：在添加vSphere资源池时，绑定备份管理平台Veeam，使用vSphere资源池部署的虚拟机将自动关联到Veeam，通过备份管理平台来管理云主机。

+ 备份恢复运维操作，vSphere资源池与备份管理平台Veeam进行绑定之后，使用vSphere资源池部署成功的云主机，点击左侧导航栏「我的部署」-「云主机」，支持进行基本的「备份」/「恢复」操作。


# 操作审计


支持对用户访问、操作信息的记录，租户管理员和sysadmin默认有该权限，若需要为其他角色增加该权限，
请新增角色并添加该权限，详见[角色](https://cloudchef.github.io/doc/AdminDoc/04组织架构管理/角色.html)

点击左侧导航栏的「系统管理」-「操作审计」，可看到该租户下的操作记录。显示操作的者、操作对象、操作名称、操作参数、状态以及操作时间。可通过「高级搜索」进行快速筛选定位，支持操作者、状态、操作对象、起止时间的筛选，也可以使用普通搜索功能。
