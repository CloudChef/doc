**计量计费**

+ 资源使用分析：发现和分析多云环境的使用情况和利用率，让所有资源可追踪、可追溯。通过自定义成本核算，公有云成本可见性，洞察多云环境的花费，提高ROI。可为计算、存储、网络、PaaS服务等数据中心资源，按照不同时间维度设置计费规则；自动按照部门、项目等维度进行分账；多维度展现费用使用情况和趋势；欢迎页一览资源总体情况；丰富的开箱即用的图表，多维度展示资源状况；仪表盘、报表可按需自定义，为不同角色配置不同视图。
+ 费用优化：费用可视化，结合资源使用率，帮助优化工作负载部署，合理化配置。申请时候预估整体服务价格，进行不同云平台的比价；结合资源使用率和成本，提出优化建议，降低过高配置。
+ 支持自定义计费模型，以实现私有云的计量计费；并且支持按照策略定时同步公有云账单，结合全新的费用分析模块，统一公有云和私有云的费用管理和分析。

![计量计费](../../picture/Admin/计量计费.png)

# 费用分析

## 费用展示 

点击左侧导航「计量计费」-「费用分析」，显示费用展示：该页面显示各业务组的费用占比，以时间为跨度的费用趋势，可根据时间、云平台、资源类型、业务组、项目和所有者进行筛选查看。

## TOP排行

TOP排行展示了云平台费用使用TOP5、资源类型费用使用TOP5、业务组费用使用TOP5、项目费用使用TOP5、服务部署费用使用TOP5、所有者费用使用TOP5。可根据时间、云平台、资源类型、业务组、项目和所有者进行筛选查看

# 优化建议

优化建议功能列表展现了云资源的使用情况，以及费用情况，帮助您找出使用率较低的资源，并可以直接进行配置调整。

使用率分数是综合了CPU、内存以及磁盘的平均使用情况。根据使用率分数的排序找出闲置资源分布情况（使用率分数越小表示闲置资源越多），并能够一键重新进行配置，从而及时调整低效使用的资源，节省费用。

1.  点击左侧导航「计量计费」-「优化建议」，展示所有虚拟机的使用情况：该页面显示各云主机的名称、状态、使用率分数、CPU使用率、内存使用率、磁盘使用率、费用（参考值）、配置（CPU/内存/磁盘）、业务组
    、项目、所有者。

2.  详细使用情况参数请看下表介绍：

 + 业务组	所属业务组
 + 名称	名称（若业务组已设定命名规则，名称将按照规则自动生成，无需填写）
 + 项目	所属项目
 + 所有者	部署的所有者
 + 状态	三种状态：已启用、已停止、遗失
 + CPU使用率	一段时间CPU的平均使用率（上周、上个月、上三个月、上半年）
 + 内存使用率	过去一段时间内存的平均使用率（上周、上个月、上三个月、上半年）
 + 磁盘使用率	过去一段时间磁盘的平均使用率（时上周、上个月、上三个月、上半年）
 + 使用率分数	过去一段时间磁盘的平均使用率和内存的使用率和CPU的使用率，三者的平均数（上周、上个月、上三个月、上半年）
 + 分数越小代表使用率越低，闲置资源越多
 + 费用	按照上个月部署资源的花费预计下个月的部署虚拟机的费用（数值统一了公有云和私有云的费用）



1.  平台考虑了计算、网络、存储的使用率，基于数据监控，算出过去一个星期
    、一个月、三个月或半年的磁盘使用率、内存使用率、CPU使用率的平均值，三者平均值之和得到使用率分数。根据以上展示的所有数据，找出闲置资源，排序分析得出费用比较高的虚拟机，使用率比较低的虚拟机，进行一键重新配置，优化资源配置，提高资源使用率。

2.  重新配置资源的方法：

 点击左侧导航「计量计费」-「优化建议」，选择某一个云主机，进入云主机详情页，显示云主机基本信息、操作历史、快照信息、监控、已触发警报、定时任务等，在云主机详情页可重新配置资源，可进行如下操作：
 重新启动、挂起、停止、远程终端、调整虚机配置、添加新磁盘、扩展磁盘、添加网卡、删除网卡、创建快照、恢复至快照、vMotion迁移等。

  使用情况       
 
 + 重新启动       重新启动（关机状态的）虚拟机，也可以通过设置「定时」，定时（在将来某一时刻）触发此项任务。
 + 挂起           挂起（开机状态的）虚拟机，可以通过设置「定时」，定时（在将来某一时刻）触发此项任务
 + 停止           停止（即关机）（开机状态的）虚拟机，可以通过设置「定时」，定时（在将来某一时刻）触发此项任务。
 +   远程终端       进入远程终端页面。输入要执行的命令，单击确认
 +   调整虚机配置   调整虚拟机或容器节点的配置（vCPU，内存）
 +   添加新磁盘     给虚拟机添加一块新的磁盘，可以通过设置「定时」，定时（在将来某一时刻）触发此项任务
 +   扩展磁盘       给虚拟机扩展一块已有的磁盘，可以通过设置「定时」，定时（在将来某一时刻）触发此项任务。
 +   添加网卡       添加一个新网卡，针对该计算节点的所有实例生效，选择网络标签和IP分配方式
 +   删除网卡       删除网卡，该操作会影响该节点的所有云主机
 +   创建快照       给虚拟机创建一个快照，可以通过设置「定时」，定时（在将来某一时刻）触发此项任务。
 +   恢复至快照     把虚拟机恢复到之前的某一个快照，可以通过设置「定时」，定时（在将来某一时刻）触发此项任务
 +   vMotion迁移    计算资源迁移和存储迁移

>「Note」如您需要查看更多关于云主机操作的详细内容，请您参考：[云主机操作](https://cloudchef.github.io/doc/AdminDoc/06云资源的全生命周期管理/我的部署.html)

# 计费规则

SmartCMP允许自定义计费规则，对纳管的云平台多种不同类型资源进行计费；并能够同步公有云的费用账单（详见「账单同步」小节），统一公有云和私有云的费用管理和分析。

+ 平台支持多种计费模式，包括，经典模式、专家模式、公有云计费。
    + 经典模式，是指当前的计费规格都是对单种资源来计费的，您可以按需选择云平台、资源池后，指定组件类别，选择具体的组件来设定价格，例如：针对腾讯云平台下的全部资源池，IaaS组件类别的云主机设置价格。
    + 专家模式，通过脚本定义一套计费规则，例如：阿里云的规格类型多种多样，不同规格的价格不一致，如果单个配置会非常繁琐，支持Javascript的脚本来定义一套阿里云不同规格的计费价格。
    + 公有云计费模式，面向公有云转售的业务场景，租户管理员可以针对不同的资源设定不同的折扣系数，即SmartCMP作为云资源转售平台，帮助运营商和IDC向用户售卖云资源与服务，运营商和IDC实际转售的是公有云厂商的资源，通过自定义折扣系数，实现资源的灵活计价。
+ 计费规则支持多个货币单位，包括，人民币、美元、沙特里亚尔等等，租户管理员可以在系统配置选择一个货币单位，（默认人民币）可以选择沙特里亚尔或美元。选择后，计费规则、资金账户的充值时候的货币单位都为配置的保存一致。

  

下文为您介绍添加、编辑、删除计费规则的步骤：
点击左侧菜单栏「计量计费」-「计费规则」，将看到已创建好的计费规则列表，  列表中列出了已经创建的资源类型及价格等信息。系统管理员和租户管理员可以对已创建的计费规格进行编辑和删除，同时可以添加新的计费规格。计费规则会显示云平台、资源类别、存储类别、计价单位、价格、货币单位、周期等。

1.  添加计费规则：进入菜单「计量计费」-「计费规则」，点击「添加」，在弹出页面中选择云平台管理、资源池、资源类别（CPU、内存、存储组件、浮动IP、负载均衡器、负载均衡监听器），计价单位、价格，货币单位（人民币）、周期（小时、天、周、月），点击「提交」，添加计算资源价格成功，计费管理列表显示刚才添加的信息。

2.  编辑计费规则：选中列表中某个项目，点击「编辑」，修改信息后点击「提交」

3.  删除计费规则：选中列表中某个项目，点击「删除」，弹出确认提示框，点击「是」

# 账单同步

支持定时同步公有云的账单数据。点击左侧菜单栏「计量计费」-「账单同步」，将看到账单同步列表，显示名称、云平台、状态（禁用/启用）、最近执行记录、最近执行时间等。可进行添加、编辑、删除、启用和禁用操作。

1.  添加同步策略：点击「添加」，输入同步策略名称、选择一个要同步的云平台、选择状态（启用/禁用）、填写执行时间（cron表达式），点击「保存」

2.  编辑同步策略：在列表中选择一项同步策略，点击「编辑」，进入编辑界面，可更改名称、云平台、对象存储、状态、执行时间等，页面下方显示该同步历史信息

3.  启用/禁用同步策略：在列表界面选择某项已启用/禁用的同步策略，上方的禁用/启用操作将可用
