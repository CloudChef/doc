**计量计费**

# 费用类型

平台支持为不同的云资源类型关联计费项，从而将费用账单中的费用明细按照费用类型进行匹配。用户可以使用平台内置的费用类型，也可以根据业务需要自定义添加。
平台内置费用类型涵盖云主机、网络（如浮动IP、VPN、防火墙等）、存储、监控、缓存及关系型数据库等。内置的费用类型不允许修改或删除，用户可以复制该费用类型，或在该类型分组下创建新的费用类型分组。

您可以根据以下步骤自定义添加费用类型及计费项：
1. 点击左侧导航 计量计费 - 费用类型 ，当前页面展示平台内置的所有费用类型及分组。
2. 点击添加费用类型，输入主键、名称及描述，点击保存并成功创建类型分组。

您可以在内置费用类型或自定义添加的费用类型下添加计费项。
1. 选择某一费用类型，点击计费项下的添加按钮。在费用明细映射页面，输入名称、描述及代码（如instance_type）。
2. 添加计费项属性，输入属性主键、名称、描述、默认值，选择属性类型及备选项。您可以添加一个或多个计费项属性。
3. 若此计费项是公有云计费项，勾选 公有云计费项 并在映射标签页下公有云映射关系。映射表示每一个计费项与各个公有云平台中相关产品和实际计费项的关联关系。


# 费用明细

用户可以通过云平台管理启用账单同步，定时同步导入费用信息。在费用明细页面，用户可以查看已导入的费用明细和自定义新增明细信息，同时您可以在费用明细详情中进行费用校准和更改费用归属。

针对平台已管理的资源，如果因某些原因导致公有云、私有云账单不准的，用户可以通过执行创建新账单（差价）、更新账单费用或删除账单的操作来校准账单费用。
+ 点击费用明细页面的一条费用类型，可以编辑该费用的归属（业务组、项目及所有者）和配置（费用类型及计费项）并校准账单费用。
+ 支持费用明细多选，批量编辑归属（业务组、项目及所有者）或者删除费用。

费用明细页面支持根据业务组、项目、所有者、时间、云平台、资源类型、费用类型等不同维度进行筛选查看。

点击刷新按钮，将把最新的费用明细同步到当前页面，同时把最新的费用类型和计费项更新到当前所有的费用明细中。

点击导出按钮，可以导出费用明细为.xlsx文件。

# 费用分析

SmartCMP能够从不同维度统计资源费用信息，帮助您了解各个业务组、项目、云平台等在过去一段时间内的花费情况。

点击左侧导航 计量计费 - 费用分析 ，该页面展示了“总费用趋势”、“今天预测费用”、“费用占比”、“费用趋势”及“TOP排行”模块。各模块支持根据分组（费用类型、云平台入口、业务组、所有者等）、时间粒度（天、月）和具体时间跨度进行筛选展示，同时支持更多筛选维度如资源类型、费用类型、键值标签等。

“总费用趋势”和“费用趋势”的图表形式支持折线图和（堆叠）柱状图，点击模块右上角下拉框可切换图表形式。

鼠标悬浮于图表上时，将显示悬浮区域的数据明细。点击“总费用趋势”和“费用趋势”中的某一项将跳转至[费用明细](#费用明细)页面，可根据时间、云平台、资源类型、费用类型、业务组、项目和所有者等不同维度进行筛选查看。

点击“费用占比”和“TOP排行”的某一项资源类型，将跳转至该类型的费用概览页面，包含“总费用趋势”、“今天预测费用”、“分组费用占比和趋势”及“费用明细”模块。支持根据时间粒度、分组、业务组、所有者等维度筛选展示，以及图表形式切换。

![费用分析](../../picture/Admin/费用分析.png)

# 费用报表

系统提供内置的费用报表供用户查看。

点击 计量计费 - 费用报表 ，可查看费用报表：业务组费用统计报表，业务组费用明细报表，项目费用统计报表，云平台费用统计报表，云资源费用明细报表。 

以业务组费用明细报表为例介绍报表生成的步骤：

1. 点击任意报表名称进入报表生成页面。点击生成，可生成用户所属业务组所有费用明细报表。

2. 用户可根据云平台类型、业务组、云平台类型、费用类型及起始时间进行筛选。

3. 可点击合并左边相同维度行，并可选择需要展示的报表表头，如：云平台名称、费用。

3. 点击导出可以导出筛选后的报表，导出格式为Excel文件。

# 优化建议

优化建议列表展现了需进行费用优化的资源，您可以根据操作建议进行配置调整。

点击资源名称可进入优化建议详情页，展示了影响程度、修复建议与操作（如有）、状态、触发的修复操作、任务状态、执行人以及开始/结束时间。

您可以根据修复建议与建议修复操作一键对需要费用优化的资源进行修复（要求策略中已定义建议修复操作）：
1. 点击建议修复操作中已配置的操作名称（如“启动云主机”操作），对资源进行费用优化。您也可以点击“更多操作”，选择刷新状态、启动、停止、更改配置等该云资源支持的Day 2运维操作。
2. 正在修复的资源状态将被标记为“修复中”，若资源修复成功，状态将被标记为“已修复”，若资源修复失败将被标记为“未修复”。
3. 在优化建议详情页面可以查看历史修复记录，包含：操作、服务名称、请求用户及状态等。
4. 同时平台支持您根据修复建议手动对资源进行修复，修复后您可以在优化建议详情页手动将该条优化建议的状态修改为已修复。


# 计费规则

SmartCMP允许自定义计费规则，对纳管的私有云、公有云等多种不同类型资源进行计费；并能够同步公有云的费用账单（详见账单同步小节），统一公有云和私有云的费用管理和分析。

+ 平台支持多种计费模式，包括，经典模式、专家模式、公有云计费。
    + 经典模式，是指当前的计费规格都是对单种资源来计费的，您可以按需选择云平台、资源池后，指定组件类别，选择具体的组件来设定价格，例如：针对腾讯云平台下的全部资源池，IaaS组件类别的云主机设置价格。

    + 专家模式，通过脚本定义一套计费规则，例如：阿里云的规格类型多种多样，不同规格的价格不一致，如果单个配置会非常繁琐，支持Javascript的脚本来定义一套阿里云不同规格的计费价格。


+ 计费规则支持多个货币单位，包括，人民币、美元、沙特里亚尔等等，您可以在系统配置选择一个货币单位，（默认人民币）可以选择沙特里亚尔或美元。选择后，计费规则、资金账户的充值时候的货币单位都为配置的保存一致，并且三种货币单位，都支持设定打折系数。。

  

下文为您介绍添加、编辑、删除计费规则的步骤：

点击左侧菜单栏 计量计费 - 计费规则 ，将看到已创建好的计费规则列表，列表中列出了已经创建的资源类型及价格等信息。您可以对已创建的计费规格进行编辑和删除，同时可以添加新的计费规格。计费规则会显示云平台、资源类别、存储类型、计价单位、价格、货币单位、周期等。

  1.  添加计费规则：进入菜单 计量计费 - 计费规则 ，点击添加，在弹出页面中填写以下信息：
      
      +  名称：自定义计费名称，请说明云资源类型
      
      +  云平台类型、云平台：根据接入的云平台进行选择
      
      +  资源池：选择全部资源池
      
      +  模式：根据业务需求选择计费模式，可选模式包括经典模式和专家模式

      +  组件类别：根据业务需求选择计费模式，可选范围包括Iaas、Paas、Caas、软件、代理和其他

      +  价格：设置云资源具体价格

      +  周期：设置计费时长，可选小时、天、周、月

      +  计费脚本：选择“专家模式”时，可通过输入脚本自定义一套计费规则

      +  打折系数：可针对公有云平台不同的资源设置不同的折扣系数

      +  费用类型及计费项：选择平台内置或者用户自定义添加的费用类型和计费项。若留空，系统将映射到默认的费用类型和计费项。

      +  结单周期：设置结单周期的频率，平台将对该计费规则产生的费用数据按照配置周期频率进行结单处理，默认为每天。
      
      点击提交，添加计费规则成功，计费管理列表显示刚才添加的信息，在费用明细页面将生成计费规则对应的费用账单记录。

  2.  编辑计费规则：选中列表中某个项目，点击编辑，修改信息后点击保存。

  3.  删除计费规则：选中列表中某个项目，点击删除，弹出确认提示框，点击确认。
