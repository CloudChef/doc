**费用管理**

# 费用类型

平台支持为不同的云资源类型关联计费项，从而将费用账单中的费用明细按照费用类型进行匹配。用户可以使用平台内置的费用类型，也可以根据业务需要自定义添加。
平台内置费用类型涵盖云主机、网络（如浮动IP、VPN、防火墙等）、存储、监控、缓存及关系型数据库等。内置的费用类型不允许修改或删除，用户可以复制该费用类型，或在该类型分组下创建新的费用类型分组。

您可以根据以下步骤自定义添加计费类型：
1. 点击左侧导航 计量计费 - 费用类型 ，当前页面展示平台内置的所有费用类型及分组。
2. 点击添加费用类型，输入主键、名称及描述，点击保存并成功创建类型分组。
3. 在 费用明细映射 页面，输入名称、描述及代码（如instance_type）。
4. 若此计费项是公有云计费项，勾选 公有云计费项 并在映射标签页下公有云映射关系。映射表示每一个计费项与各个公有云平台中相关产品和实际计费项的关联关系。


# 费用明细

用户可以通过云平台管理启用账单同步，定时同步导入费用信息。在费用明细页面，用户可以查看已导入的费用明细和自定义新增明细信息，同时您可以在费用明细详情中进行费用校准和更改费用归属。

针对平台已管理的资源，如果因某些原因导致公有云、私有云账单不准的，用户可以通过执行创建新账单（差价）、更新账单费用或删除账单的操作来校准账单费用。
+ 点击一条费用明细ID，可以编辑该费用的归属（业务组、项目及所有者）和配置（费用类型及计费项）并校准账单费用。
+ 支持费用明细多选，批量编辑归属（业务组、项目及所有者）或者删除费用。

费用明细页面支持根据业务组、项目、所有者、时间、云平台、资源类型、费用类型等不同维度进行筛选查看。

点击刷新按钮，将把最新的费用明细同步到当前页面，同时把最新的费用类型和计费项更新到当前所有的费用明细中。

# 费用分析

SmartCMP能够从不同维度统计资源费用信息，帮助您了解各个业务组、项目、云平台等在过去一段时间内的花费情况。

## 费用展示 

点击左侧导航 计量计费 - 费用分析 ，进入费用展示标签页。该页面显示各业务组、项目和云平台的费用占比，以时间为跨度的费用趋势，可根据时间、云平台、资源类型、费用类型、业务组、项目和所有者等不同维度进行筛选查看。

鼠标悬浮于饼图或柱状图上时，将显示悬浮区域的数据大小。点击饼图或柱状图中的某一项将跳转至[费用明细](#费用明细)页面，可根据时间、云平台、资源类型、费用类型、业务组、项目和所有者等不同维度进行筛选查看。

## TOP排行

TOP排行展示了云平台费用使用TOP5、资源类型费用使用TOP5、业务组费用使用TOP5、项目费用使用TOP5、费用类型使用TOP5和所有者费用使用TOP5等信息。可根据时间、云平台、资源类型、费用类型、业务组、项目和所有者等不同维度进行筛选查看。

# 优化建议

优化建议功能列表展现了云资源的使用情况，以及费用情况，帮助您找出使用率较低的资源，并可以直接进行配置调整。

使用率分数是综合了CPU、内存以及磁盘的平均使用情况。根据使用率分数的排序找出闲置资源分布情况（使用率分数越小表示闲置资源越多），并能够一键重新进行配置，从而及时调整低效使用的资源，节省费用。

1.  点击左侧导航 计量计费 - 优化建议 ，展示所有云资源的使用情况：该页面显示各云资源的名称、状态、使用率分数、CPU使用率、内存使用率、磁盘使用率、过去一个月费用、配置（CPU/内存/磁盘）、业务组、项目、所有者等信息。

2.  详细使用情况参数请看下表介绍：

 + 业务组：云资源所属业务组
 + 名称：名称（若业务组已设定命名规则，名称将按照规则自动生成，无需填写）
 + 项目：云资源所属项目
 + 所有者：部署资源的所有者
 + 状态：目前展现三种状态，分别是已启用、已停止、遗失
 + CPU使用率：过去一段时间CPU的平均使用率（上周、上个月、上三个月、上半年）
 + 内存使用率：过去一段时间内存的平均使用率（上周、上个月、上三个月、上半年）
 + 磁盘使用率：过去一段时间磁盘的平均使用率（时上周、上个月、上三个月、上半年）
 + 使用率分数：过去一段时间磁盘的平均使用率，内存的使用率和CPU的使用率，三者的平均数（上周、上个月、上三个月、上半年），分数越小代表使用率越低，闲置资源越多
 + 费用	按照上个月部署资源的花费预计下个月的部署虚拟机的费用（数值统一了公有云和私有云的费用）


平台考虑了计算、网络、存储的使用率，基于数据监控，算出过去一个星期、一个月、三个月或半年的磁盘使用率、内存使用率、CPU使用率的平均值，三者平均值之和得到使用率分数。根据以上展示的所有数据，找出闲置资源，排序分析得出费用比较高的虚拟机，使用率比较低的虚拟机，进行一键重新配置，优化资源配置，提高资源使用率。

重新配置资源的方法：

1.  点击左侧导航 计量计费 - 优化建议 ，选择某一个云主机，进入云主机详情页，显示云主机基本信息、操作历史、快照信息、监控、已触发警报、定时任务等，在云主机详情页可重新配置资源，可进行如下操作：重新启动、挂起、停止、远程终端、调整虚机配置、添加新磁盘、扩展磁盘、添加网卡、删除网卡、创建快照、恢复至快照、vMotion迁移等。
    
 + 重新启动： 重新启动（关机状态的）虚拟机，也可以通过设置定时，定时（在将来某一时刻）触发此项任务。
 + 挂起：挂起（开机状态的）虚拟机，可以通过设置定时，定时（在将来某一时刻）触发此项任务
 + 停止：停止（即关机）（开机状态的）虚拟机，可以通过设置定时，定时（在将来某一时刻）触发此项任务。
 + 远程终端：进入远程终端页面。输入要执行的命令，单击确认
 + 调整虚机配置：调整虚拟机或容器节点的配置（vCPU，内存）
 + 添加新磁盘：给虚拟机添加一块新的磁盘，可以通过设置定时，定时（在将来某一时刻）触发此项任务
 + 扩展磁盘：给虚拟机扩展一块已有的磁盘，可以通过设置定时，定时（在将来某一时刻）触发此项任务。
 + 添加网卡：添加一个新网卡，针对该计算节点的所有实例生效，选择网络标签和IP分配方式
 + 删除网卡：删除网卡，该操作会影响该节点的所有云主机
 + 创建快照：给虚拟机创建一个快照，可以通过设置定时，定时（在将来某一时刻）触发此项任务。
 + 恢复至快照：把虚拟机恢复到之前的某一个快照，可以通过设置定时，定时（在将来某一时刻）触发此项任务
 + vMotion迁移：计算资源迁移和存储迁移

>「Note」如您需要查看更多关于云主机操作的详细内容，请您参考：[云主机操作](http://CMP-PUBLIC-IP/help/AdminDoc/14我的部署/云主机.html#云主机运维操作)


# 计费规则

SmartCMP允许自定义计费规则，对纳管的私有云、公有云等多种不同类型资源进行计费；并能够同步公有云的费用账单（详见账单同步小节），统一公有云和私有云的费用管理和分析。

+ 平台支持多种计费模式，包括，经典模式、专家模式、公有云计费。
    + 经典模式，是指当前的计费规格都是对单种资源来计费的，您可以按需选择云平台、资源池后，指定组件类别，选择具体的组件来设定价格，例如：针对腾讯云平台下的全部资源池，IaaS组件类别的云主机设置价格。

    + 专家模式，通过脚本定义一套计费规则，例如：阿里云的规格类型多种多样，不同规格的价格不一致，如果单个配置会非常繁琐，支持Javascript的脚本来定义一套阿里云不同规格的计费价格。


+ 计费规则支持多个货币单位，包括，人民币、美元、沙特里亚尔等等，您可以在系统配置选择一个货币单位，（默认人民币）可以选择沙特里亚尔或美元。选择后，计费规则、资金账户的充值时候的货币单位都为配置的保存一致，并且三种货币单位，都支持设定打折系数。。

  

下文为您介绍添加、编辑、删除计费规则的步骤：

点击左侧菜单栏 计量计费 - 计费规则 ，将看到已创建好的计费规则列表，列表中列出了已经创建的资源类型及价格等信息。您可以对已创建的计费规格进行编辑和删除，同时可以添加新的计费规格。计费规则会显示云平台、资源类别、存储类型、计价单位、价格、货币单位、周期等。

  1.  添加计费规则：进入菜单 计量计费 - 计费规则 ，点击添加，在弹出页面中填写以下信息：
      
      +  名称：自定义计费名称，请说明云资源类型
      
      +  云平台类型：根据接入的云平台进行选择
      
      +  资源池：选择全部资源池
      
      +  模式：根据业务需求选择计费模式，可选模式包括经典模式、专家模式和公有云计费模式

      +  组件类别：根据业务需求选择计费模式，可选范围包括Iaas、Paas、Caas、软件、代理和其他

      +  价格：设置云资源具体价格

      +  周期：设置计费时长，可选小时、天、周、月

      +  计费脚本：选择“专家模式”时，可通过输入脚本自定义一套计费规则

      +  折扣系数：可针对公有云平台不同的资源设置不同的折扣系数
      
      点击提交，添加计算资源价格成功，计费管理列表显示刚才添加的信息。

  2.  编辑计费规则：选中列表中某个项目，点击编辑，修改信息后点击保存。

  3.  删除计费规则：选中列表中某个项目，点击删除，弹出确认提示框，点击确认。


