
**云主机**

　　用户可以查看云主机列表来对其进行管理和操作，操作的启用和是否需要审批需要在业务组级别或者服务配置级别进行设置。

# 云主机信息查看

　　在左侧导航栏选择 我的部署 - 云主机 后，用户将会看到云主机的列表。可在该列表界面查看云主机的详细信息。可通过点击右上角选择展示列的按钮，选择您需要的列进行展示。

　　在云主机列表中，用户可以选中一个或者多个云主机快速进行一些操作，包括启动、重启、挂起、停止、执行脚本、设置标签、启用/切换监控、更新监控代理，具体操作介绍会在下文展开

　　您也可以单击某一个云主机进入其详情界面进行管理和操作：

  - 概况：包括了云主机的主要配置信息，以及监控信息（如果启用了监控）。

  - 监控：包括了该云主机CPU、内存、磁盘、网络的监控数据（可以按照需要调整时间跨度或者平均时间来查看历史监控数据）

  >「Note」只有在云主机模板中配置安装监控的云主机在部署生成后，才可以在监控中看到数据，如何配置安装监控请参看 云主机模板 章节。

  - 已触发警报：如果配置了告警，该云主机有警报产生，可在此处查看所有警报。

  - 快照信息：显示当前的快照信息（快照名称、创建时间等），点击添加可以创建快照。支持vSphere、OpenStack和阿里云主机。

  - 定时任务：列出了您针对该云主机设置的所有定时任务。

  - 操作历史：包括了该云主机进行过的操作的历史记录

  - 操作列表：云主机图标的上方显示了运维的操作列表，具体操作介绍会在下文展开

# 云主机运维操作

　　在云主机列表界面或点击云主机名称进入云主机详情页面，均可对云主机进行下列运维操作。

  >「Note」
  * 列表页面看批量对云主机进行操作。不能批量进行的操作请进入云主机详情页面
  * 只有在业务组设置或服务配置时配置云主机的操作许可，云主机在部署生成后才能看到允许的操作列表，如何配置云主机操作许可请参看 业务组 和 服务配置 章节。
  * 运维操作针对不同云平台的云主机略有不同。

 ## 启动

　　可以实时启动（关机状态的）云主机，也可以通过设置启用定时，定时（在将来某一时刻）触发此项任务。

 ## 挂起（vSphere）

　　挂起一个或者多个（开机状态的）云主机，可以通过设置启用定时，定时（在将来某一时刻）触发此项任务。

 ## 停止

　　可以实时关机（开机状态的）云主机，可以通过设置启用定时，定时（在将来某一时刻）触发此项任务。

 ## 重启

　　重启一个或者多个（开机状态的）云主机，可以通过设置启用定时，定时（在将来某一时刻）触发此项任务。

 ## 执行脚本

　　在该云主机中执行一个脚本库的脚本，可以通过设置启用定时，定时（在将来某一时刻）触发此项任务，也可选择某个IP地址。

 ## 迁移（即vSphere vMotion迁移）

　　支持对vSphere的计算资源迁移和存储迁移。利用vSphere的vMotion迁移功能，使用不同的迁移方式，将云主机在不同主机之间进行迁移。

   -   计算资源迁移：选择目标主机，可以通过设置启用定时，定时（在将来某一时刻）触发此项任务。

   -   存储迁移：

    -   链接克隆：选择需要存储，将目标云主机迁移到所选的存储中去；

    -   完全克隆：选择置备模式（与源格式相同、精简置备、厚置备延迟置零、后置备置零）；选择云主机存储策略（保留现有云主机存储策略、数据存储默认值，以及其他自定义存储策略）；存储（根据所选的存储策略判定存储的兼容性，并显示各存储的空间和占比）

   -   启用定时：设置时间在将来某一时刻触发此项任务


## 远程终端

  vSphere的云主机，将使用vSphere的Web console client，无需浏览器特别支持。

  OpenStack云主机远程终端操作需要使用VNC Web Client，您的浏览器需要支持HTML5 Canvas和HTML5 WebSockets。如果需要了解VNC WebClient所支持的全部浏览器，可以访问https：//github.com/kanaka/noVNC/wiki/Browser-support

  阿里云的云主机，远程终端使用VNC的方式，请首先在 更多操作 - 其他 - 设置VNC密码 中设置密码，然后通过远程终端，输入VNC密码后进行访问。

## 设置标签

　　可为云主机设置键值标签，从而为云主机分类和过滤。云主机标签的使用方法如下：

 - 添加标签

    + 对新建的云主机添加标签：

      1.  在左侧导航栏选择 我的部署 - 云主机 ，在云主机的列表界面，选择一个云主机

      2.  点击上方的 更多操作 - 设置标签 ，出现键值标签的设置界面

      3.  填写键、值，点击创建 - 执行，标签创建成功；也可选择已有的标签，点击执行。在云主机列表的右侧列项，可查看添加的云主机标签

    + 对导入的云主机添加标签：

      1.  在左侧菜单选择 基础设施 - 资源池管理，选择一个资源池，进入编辑资源池界面

      2.  进入云资源标签页，点击导入按钮

      3.  点击标签后的输入框，弹出键值标签创建页面，输入键值，创建新标签；也可选择已有标签

 - 修改/删除标签：

   在云主机列表界面，选择一个云主机；点击更多操作-更改配置-设置标签，出现该云主机的键标签，可直接删除并重新创建。


## 管理磁盘
  - 添加新磁盘

    点击 更多操作 - 管理磁盘 - 添加新磁盘 给云主机添加一块新的磁盘。

>「Note」vSphere云主机在挂起状态下不能执行该操作

  - 扩展磁盘

    点击 更多操作 - 管理磁盘 - 扩展磁盘 给云主机扩展一块已有的磁盘。

>「Note」vSphere云主机在挂起状态下不能执行该操作

## 更改配置

 - 调整虚机配置

     更多操作 - 更改配置 - 调整虚机配置，可调整云主机的CPU和内存配置。

>「Note」阿里云云主机需要在关机状态下进行调整。

 - 添加网卡

    添加一个新网卡，针对该计算节点的所有实例生效，选择网络标签和IP分配方式，目前vSphere只支持DHCP，OpenStack和PowerVC支持DHCP和IP池两种IP分配方式，OpenStack云主机还支持手动指定IP。

 - 删除网卡

    删除运维新增加的网卡，该操作会影响该节点的所有云主机。

 - 更新云主机名称

    点击更多操作 - 更改配置 - 更新云主机名称，可以重新设置云主机的显示名。

 - 重置操作系统主机名

    点击更多操作 - 更改配置 - 重置操作系统主机名，可以重新设置操作系统主机名，即OS Hostname。


## 管理快照
 - 创建快照

  支持创建快照的时候，设置定时循环任务，例如在每天的某个时间，每周或每月的某一天，自动的进行快照创建，并且支持随时查看、取消已经设置的定时循环任。

   1.  在左边导航选择 我的部署- 云主机 ，在右边选择快照信息

   2.  点击添加按钮 ，输入名称，若启用定时循环任务，名称将由系统自动生成。

   3.  点击确定，定时创建快照的任务设置成功。

   4.  在左边导航选择 我的部署 - 云主机 ，在右边选择定时任务

   5.  选中操作名称，点击上方的删除，即可取消已经设置的定时循环任务。

 - 恢复至快照

    把云主机恢复到之前的某一个快照。

 - 删除快照

   点击删除按钮，选择快照名称，删除已创建的快照

>「Note」阿里云的快照管理在云资源的磁盘中进行配置。

## 监控和代理

 - 启用/切换监控

   目前对云主机支持两种监控方式：平台的代理监控以及云平台监控。
   - 代理监控是通过在云主机中安装平台的监控代理，获取监控信息；
   - 云平台监控是指通过云平台的API，获取监控信息，无需安装代理。vSphere和微软Azure的云主机，阿里云的ECS、SLB、OSS、RDS等资源支持这种方式。

>「Note」请首先在阿里云和Azure云平台入口的配置中，启用云平台监控。启用后会频繁调用云平台API，可能会触发云平台的API限流机制，并需要为超出免费次数限制的API调用支付额外的费用。

 - 更新监控代理

   如果云主机安装了监控代理，可通过该操作进行更新。

## 其他

　　如果您在组件中，增加了新的运维操作，可以在此处显示。例如下图，如果您在vSphere的Instance组件中，自定义了一个备份的操作，并加入了 其他 操作分组，配置授权之后，用户可在 更多操作 - 其他 中进行点击操作。自定义组件操作的具体步骤，请参考：[配置操作](https://cloudchef.github.io/doc/AdminDoc/05服务建模/组件库.html#配置操作)

![自定义运维操作](../../picture/Admin/自定义运维操作.png)
