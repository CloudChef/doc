
**云主机**

　　用户可以根据下面的步骤来查看云主机列表来对其进行管理和操作，操作的启用和是否需要审批需要在业务组级别或者服务配置级别进行设置：

　　在左侧导航栏选择 我的部署 - 云主机 后，用户将会看到云主机的列表。可在该列表界面查看云主机名称、所属云平台、操作系统、云主机状态（已启动、遗失、停止等）、健康状态、业务组、项目、服务部署、租用到期时间、保留到期时间、所有者、IP地址、标签、已装软件、资源标签等，其他展示列可通过点击展示列按钮，可以勾选或者不选某些列进行展示。根据业务组，项目，所有者，状态，标签、云平台类型、是否启用监控、云平台类型、是否安装代理、操作系统类型、是否导入等标签页进行筛选

　　在云主机列表中，用户可以选中一个或者多个云主机快速进行一些操作，包括启动、重启、挂起、停止、执行脚本、设置标签、启用/切换监控、更新监控代理、添加自动化代理，具体操作介绍会在下文展开

　　您也可以单击某一个云主机进入其详情界面进行管理和操作，虚拟机详情界面包括概况、操作历史、快照信息、监控、应用列表和顶部的运维操作列表

  - 概况：包括了虚拟机及其相关主机的一些信息，该虚拟机在平台中的组织信息以及该虚拟机的CPU、内存、存储的运行状态、VNC连接信息等

  - 操作历史：包括了该虚拟机进行过的操作的历史记录

  - 快照信息：显示当前的快照信息（快照名称、创建时间等），点击添加可以创建快照

  - 监控：包括了该虚拟机CPU、内存、磁盘、网络的监控数据（可以按照需要调整时间跨度或者平均时间来查看历史监控数据）

  >「Note」只有在虚拟机模板中配置安装监控的虚拟机在部署生成后，才可以在监控中看到数据，如何配置安装监控请参看 虚拟机模板 章节。

  - 应用列表：显示当前虚机已安装的应用列表

  运维的操作列表：包括了该虚拟机可执行的操作列表，具体操作介绍会在下文展开

  >「Note」只有在业务组设置或服务配置时配置虚拟机的操作许可，虚拟机在部署生成后才能看到允许的操作列表，如何配置虚拟机操作许可请参看 业务组 和 服务配置 章节。

## 云主机运维操作{#云主机运维操作}

　　在云主机列表界面或点击云主机名称进入云主机详情页面，均可对云主机进行下列运维操作，运维操作的启用与否由业务组/服务部署进行控制。

 ### 启动 

　　可以实时启动（关机状态的）虚拟机，也可以通过设置启用定时，定时（在将来某一时刻）触发此项任务。

 ### 挂起（vSphere）

　　挂起一个或者多个（开机状态的）虚拟机，可以通过设置启用定时，定时（在将来某一时刻）触发此项任务。

>「Note」只有vSphere的虚拟机才会有此操作选项。

 ### 停止 

　　可以实时关机（开机状态的）虚拟机，可以通过设置启用定时，定时（在将来某一时刻）触发此项任务。

 ### 重启

　　重启一个或者多个（开机状态的）虚拟机，可以通过设置启用定时，定时（在将来某一时刻）触发此项任务。

 ### 执行脚本 

　　在该虚拟机中执行一个脚本库的脚本，可以通过设置启用定时，定时（在将来某一时刻）触发此项任务，也可选择某个IP地址。

>「Note」如果没有安装代理，执行脚本时必须输入虚机的用户名和密码



 ### vMotion迁移（vSphere）

　　支持对vSphere的计算资源迁移和存储迁移。利用vSphere的vMotion迁移功能，使用不同的迁移方式，将虚拟机在不同主机之间进行迁移。

   -   计算资源迁移：选择目标主机，可以通过设置启用定时，定时（在将来某一时刻）触发此项任务。

   -   存储迁移：

   -   链接克隆：选择需要存储，将目标云主机迁移到所选的存储中去；

   -   完全克隆：选择置备模式（与源格式相同、精简置备、厚置备延迟置零、后置备置零）；选择虚拟机存储策略（保留现有虚拟机存储策略、数据存储默认值，以及其他自定义存储策略）；存储（根据所选的存储策略判定存储的兼容性，并显示各存储的空间和占比）

   -   启用定时：设置时间在将来某一时刻触发此项任务

>「Note」只有vSphere的虚拟机才会有此操作选项。迁移存储时，可保留原有的置备模式和存储策略，或进行修改

### 远程终端 

>「Note」OpenStack虚拟机远程终端操作需要使用VNC Web Client，您的浏览器需要支持HTML5 Canvas和HTML5 WebSockets。如果需要了解VNC WebClient所支持的全部浏览器，可以访问
<https：//github.com/kanaka/noVNC/wiki/Browser-support>

   WEB远程终端（vSphere）：vSphere的Web console client，无需浏览器特别支持。

>「Note」只有vSphere的虚拟机才会有此操作选项。

 ### 设置云主机标签 

>「Note」每个用户都可以为云主机设置标签，无需管理员配置操作许可。

　　可为云主机设置键值标签，从而为云主机分类和过滤。

　　云主机标签的使用方法如下：

 - 添加标签

    + 对新建的云主机添加标签：

      1.  在左侧导航栏选择 我的部署 - 云主机 ，在云主机的列表界面，选择一个云主机

      2.  点击上方的 更多操作 - 设置标签 ，出现键值标签的设置界面

      3.  填写键、值，点击创建 - 执行，标签创建成功；也可选择已有的标签，点击执行。在云主机列表的右侧列项，可查看添加的云主机标签

    + 对导入的云主机添加标签：

      1.  在左侧菜单选择 基础设施 - 资源池管理，选择一个资源池，进入编辑资源池界面

      2.  进入云资源标签页，点击导入按钮

      3.  点击标签后的输入框，弹出键值标签创建页面，输入键值，创建新标签；也可选择已有标签

 - 修改/删除标签：

   在云主机列表界面，选择一个云主机；点击更多操作-更改配置-设置标签，出现该云主机的键标签，可直接删除并重新创建。

 




### 管理磁盘
  - 添加新磁盘

    点击更多操作-管理磁盘-添加新磁盘给虚拟机添加一块新的磁盘，可以通过设置启用定时，定时（在将来某一时刻）触发此项任务。

>「Note」在挂起状态下不能执行该操作

  - 扩展磁盘

    点击更多操作-管理磁盘-添加新磁盘给虚拟机扩展一块已有的磁盘，可以通过设置启用定时，定时（在将来某一时刻）触发此项任务。

>「Note」支持通过云管平台部署或在上一小节创建的磁盘进行扩展。在挂起状态下不能执行该操作

  - 删除磁盘 

     删除虚拟机上除系统盘以外的磁盘，包括服务配置添加的磁盘或运维新增的磁盘，均可删除。

  - 添加新逻辑卷 

     给Linux虚拟机添加一个新的逻辑卷，可以通过设置启用定时，定时（在将来某一时刻）触发此项任务。

>「Note」在挂起状态下不能执行该操作

  - 扩展逻辑卷

    给Linux虚拟机扩展一个已有的逻辑卷，可以通过设置启用定时，定时（在将来某一时刻）触发此项任务。

>「Note」支持通过云管平台部署或在上一小节创建的逻辑卷进行扩展。

### 更改配置

 - 调整虚机配置 

    调整虚拟机或容器节点的配置（vCPU数量，内存），点击确定。


 - 添加网卡

    添加一个新网卡，针对该计算节点的所有实例生效，选择网络标签和IP分配方式，目前vSphere只支持DHCP，OpenStack和PowerVC支持DHCP和IP池两种IP分配方式，OpenStack云主机还支持手动指定IP。

 - 删除网卡 

    删除运维新增加的网卡，该操作会影响该节点的所有云主机。

 - 挂载NFS 

    将一个NFS（网络文件系统）挂载到虚拟机，输入挂载点，用户，密码，输入挂载点

    >「Note」当配置NFS云平台和资源池后，此项操作才可用
 
 - 更新云主机名称

    点击更新云主机名称，可以重新设置云主机的显示名。

 - 重置操作系统主机名 

    点击重置操作系统主机名，可以重新设置操作系统主机名，请输入用户名，选择验证类型（密钥对、密码），输入密码。

>「Note」windows操作系统只有安装代理的情况下才能进行该项操作

 - 提升用户权限

    可临时给某个用户提升一段时间的Sudo权限（免密）。若该云主机已安装自动化代理，则只需输入用户名以及权限使用时间。若该云主机未安装自动化代理，将输入管理员用户名和密码（或选择密钥对）、以及选择IP地址。

### 管理快照
 - 创建快照

  支持创建快照的时候，设置定时循环任务，例如在每天的某个时间，每周或每月的某一天，自动的进行快照创建，并且支持随时查看、取消已经设置的定时循环任。

   1.  在左边导航选择 我的部署- 云主机 ，在右边选择快照信息

   2.  点击添加按钮 ，输入名称，若启用定时循环任务，名称将由系统自动生成。

   3.  点击确定，定时创建快照的任务设置成功。

   4.  在左边导航选择 我的部署 - 云主机 ，在右边选择定时任务

   5.  选中操作名称，点击上方的删除，即可取消已经设置的定时循环任务。

 - 恢复至快照（vSphere） 

    把虚拟机恢复到之前的某一个快照，可以通过设置启用定时，定时（在将来某一时刻）触发此项任务

>「Note」只有vSphere的虚拟机才会有此操作选项。

 - 删除快照 

   点击删除按钮，选择快照名称，删除已创建的快照

 - 执行快照策略

   针对阿里云的实例下的单个磁盘做执行快照策略，快照策略在阿里云平台中被创建。

 - 取消快照策略 

   针对阿里云的实例下的单个磁盘取消快照策略期间。

### 监控和代理

 - 添加自动化代理

   如果云主机未安装自动化代理，可通过该操作安装；输入具有SSH功能并具有管理员权限的用户名和密码/密钥对，输入完成后点击执行。若未输入端口，还需在云主机详情页，云主机中配置的SSH端口中输入端口号。

 - 更新自动化代理 

   如果云主机已安装自动化代理，可通过该操作进行更新。

 - 启用/切换监控

   目前对vSphere云主机支持两种监控方式：内置代理监控以及云平台监控。内置代理监控包括预安装监控代理和WinRM/SSH监控代理（WinRM对于Windows操作系统的云主机，SHH对于Linux操作系统的云主机）；云平台监控是指直接从vCenter上读取虚机的监控数据而不需要安装监控代理。对Openstack云平台只支持内置监控代理。

 - 更新监控代理 

   如果云主机安装了内置代理监控，可通过该操作进行更新。

### 其他 

　　支持根据实际需求自定义运维操作，点击更多操作- 其他，显示自定义操作列表。例如下图，为vSphere云平台的虚拟机自定义备份操作，自定义操作的具体步骤，请参考：[配置操作](https://cloudchef.github.io/doc/AdminDoc/05服务建模/组件库.html#配置操作)

![自定义运维操作](../../picture/Admin/自定义运维操作.png)


