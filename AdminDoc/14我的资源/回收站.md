**资源回收**

# 回收站

平台支持回收站功能，优化资源回收流程，存在误删除的情况时，支持找回资源与数据。
  >「Note」 若要启用回收站功能，请参考[系统参数](https://cloudchef.github.io/doc/AdminDoc/09系统管理/#系统参数)并设置回收站保留时间以及已回收资源展示时间。

找回资源具体步骤：

  1.  在左侧菜单选择 我的资源 - 回收站 在回收站列表页面再对该应用栈进行手工删除操作，该资源阶段状态显示为已删除。

  2.  回收站列表页面的服务进行还原，点击 还原 则可以还原资源。

在回收站对资源进行批量删除时，平台会生成一个工单类型为请求单的批量申请，用户可以在 服务请求 - 我的申请 查看该删除申请的详情。

# 系统自动回收资源

SmartCMP通过在业务组或服务配置设置应用栈租用时间和保留时间，使资源在被申请使用后，能够在规定时间内自动回收。

  1.   组织架构 - 业务组 ，点击业务组名称，进入 概况 页面，在该页面可修改业务组下的应用栈租用时间范围和应用栈保留时间范围

  2.   服务建模 - 服务配置 ，点击服务配置名称，进入 概况 页面，在该页面可修改服务配置下的应用栈租用时间和应用栈保留时间

      >「Note」服务配置处的租用/保留时间不能超过业务组上的最大时间范围。

若服务的租用时间到期后，该部署下的所有云主机将会被自动关机；

若服务的保留时间到期后，该部署下的所有云主机将被放入回收站。系统根据用户设置的回收站展示时间保留该部署下的云主机，到期后将自动卸除，释放资源。

# 手动回收资源

您可根据以下步骤手动回收应用栈：

1.  我的资源 - 应用栈 ，进入应用栈列表界面，选择某应用栈，顶部将出现对该服务的运维操作列表。

2.  点击更多操作-删除-卸除，
    + 若回收站开启：该应用栈的全部云资源将会被停止，同时被移入回收站。在回收保留期间，您可以去回收站进行还原或者删除操作。在回收站对该部署进行手工删除，或者保留时间过期之后，系统将从云平台上删除该部署的全部云资源。
    + 若回收站关闭：系统将删除该部署的管理信息，并从云平台中删除该部署的全部云资源。注意：该操作执行后无法恢复，请谨慎操作。

3.  您也可点击启用定时定时卸除资源。

4.  点击确定后，若业务组有审批流程，则审批通过后将开始卸除；若无审批流程，则直接开始卸除。

您可根据以下步骤手动回收应用栈下的云资源：

1.  我的资源 - 云资源 ，进入云资源列表界面，选择某个已部署云资源进入云资源详情页，顶部将出现对该云资源的运维操作列表。

2.  点击卸除：
    + 如果该资源所在部署只有一个云资源：
      + 若回收站开启：该资源将被停止并移入回收站。在回收保留期间，您可以去回收站进行还原或删除操作。在回收站对该资源进行手工删除，或者保留时间过期之后，系统将从云平台上删除云资源。
      + 若回收站关闭：系统将直接删除所选云资源的管理信息，并从云平台中删除该云资源。操作执行后无法恢复，请谨慎操作。
    + 如果该资源缩在部署有多个云资源：系统将允许用户勾选“同时删除该资源缩在部署下的其他云资源”。
      + 若回收站开启：
          + 勾选允许：该应用栈的全部云资源将会被停止，同时被移入回收站。在回收保留期间，您可以去回收站进行还原或删除操作。
          + 不勾选允许：系统将直接删除您所选的云资源，并保留部署下的其他云资源。请注意，此时被删除的云资源不会进入回收站，删除操作执行后无法恢复，请谨慎操作。
      + 若回收站关闭：
          + 勾选允许：系统将删除该应用栈下全部云资源的管理信息，并从云平台中删除该部署下全部云资源。操作执行后无法恢复，请谨慎操作。
          + 不勾选允许：系统将直接删除您所选的云资源，并保留部署下的其他云资源。被删除的云资源执行后无法恢复，请谨慎操作。

3.  您也可点击启用定时定时卸除资源。

4.  点击确定后，若业务组有审批流程，则审批通过后将开始卸除；若无审批流程，则直接开始卸除。

# 应用栈延期

若该服务将到期时，可对该应用栈进行延期。

1.  点击左侧导航栏的组织架构-业务组，点击业务组名称，进入概况标签页，在该页面可配置业务组下的最大可延期次数，以保证服务的租用时间到期后仍可以正常使用，也可控制业务组内的资源申请。

2.  业务组成员申请应用栈成功后，在 我的资源 - 应用栈 ，选择某应用栈，应用栈列表界面顶部将出现“延长过期时间”的运维操作。

3.  点击“延长过期时间”，可延长到期时间，该页面还显示已“延长次数”以及该业务组下的“最大可延期次数”。

4.  点击确定，若业务组有审批流程，则审批通过后将执行；若无审批流程，则直接开始执行。

