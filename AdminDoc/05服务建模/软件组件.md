**组件库**


 SmartCMP内建了大量常用的组件，同时，软件架构师也可以根据需要创建可重用的软件组件，将配置属性标准化，并使用操作脚本准确指定在部署缩放操作过程中如何创建、配置、启动、停止、卸载组件，实现对软件组件的生命周期管理。

支持随时重新编写这些操作脚本并实时发布，同步更新已安装的软件组件。通过定义属性并将属性作为参数传递给操作脚本，使用软件属性参数化操作脚本可使脚本成为通用和可重用脚本，以便在不同的环境中部署软件组件，而无需修改脚本。

SmartCMP中的组件由属性和接口构成,软件组件由脚本、属性、元数据、生命周期管理四项共同组成，灵活的软件组件，可以关联主流制品库。具体概念如下：

 -   脚本：生命周期的每个阶段都通过脚本来进行控制，得益于强大的底层类库，SmartCMP支持包括Shell,Powershell,Ruby,Python等语言，可以快速将应用的部署整合在云管平台内；

 -   属性：不同应用系统对资源的需求和容量的控制都会有自定义要求，属性项可以按照不同系统的部署要求传递自定义参数。软件架构师可以通过设置自定义属性，将应用组件需要您填写的配置参数暴露在申请界面上，SmartCMP云管理平台会自动化调用相关参数执行应用的安装配置；

 -   操作：SmartCMP云管理平台可以对应用系统的创建、配置、启动、停止、删除等过程进行完整的生命周期管理。通过脚本对应，完成从安装部署到到期卸载的所有软件配置工作。

 -   软件组件与主流制品库关联，支持对接Jfrog Artifactory, Nexus制品库，实现软件版本的更新。

 -  组件也是构成蓝图的基本单元， 软件架构师可以通过组件管理界面管理组件。在左边导航选择「服务建模」-「软件组件」，右侧浏览区域出现所有组件列表。通过拖拽的方式组合组件，形成蓝图部署服务的编排。



# 功能介绍

## 树形展示
支持组件的分组目录，支持树形结构，可以在创建组件和组件列表搜索树形展示。在组件列表页的树形图可以增删改，已存在组件目录不能删除。
树形结构是一个逻辑的文件夹的概念，与组件的资源类型没有绑定的关系。
树形结构允许用户调整，比如有的用户一级是云平台，二级是该云平台下的计算、存储、网络组件；而有的用户一级是计算、网络、存储等，二级是各个云平台。具体内容：

+ Iaas  用于描述所有的Iaas的组件, 每个组件有自己的云平台类型,Iaas下的二级节点主要包括: 计算, 网络, 存储, 对象存储, 负载均衡, 安全组, 文件系统等
默认增加如下子类
云主机
存储
OSS:  对象存储
Disk: 块存储
NAS
Network: 网络
Subnet：子网
Router：路由
SecurityGroup：安全组
防火墙
负载均衡 (F5 的Pool 和SNATPool放这)
负载均衡监听器
浮动IP
域名
网关


+ Paas   用于描述所有的Pass的组件, 每个组件有自己的云平台类型,Paas下的二级节点主要包括云平台提供的服务能力,
默认增加如下子目录
Web
APP
MQ
Cache:缓存
RDS
NoSQL
BigData：大数据服务

+ Container，用于描述所有的容器平台的组件
Docker
Kubernetes

+ 软件组件 用于描述所有的Software的组件, 每个组件有自己的云平台类型, 软件分为两种类型, 一种是二进制安装的软件, 运行在机器里面, 一种是容器镜像软软件, 运行在容器里面 容器镜像组件可以通过类型进行区分，
  增加一个属性resource.software，来标记这个软件运行在机器里面还是容器里面。
默认增加如下子目录
Web
APP
MQ
Cache:缓存
RDS
NoSQL
BigData：大数据服务

+ 代理，表示所有的代理组件, 包括自动化组件, 监控组件等, 用于后续的代理管理
包括监控代理和自动化代理
>监控组件:若需要使用云平台监控查看云服务器指标数据并且产生告警，需在云服务器上正确安装监控组件，云服务器指标数据采集依赖于监控组件。


## 开箱即用
支持软件库功能，并且系统自带MySQL、Apache、Tomcat、Weblogic等常用开源软件，同时允许用户通过自定义的方式将自己的软件上传至软件库，在申请和创建虚拟机时，支持软件自动部署；
SmartCMP内置了常用的丰富组件：计算，网络，存储，应用软件部署，例如MySQL、Oracle等。还有一些常用的Web服务器，例如WebLogic，JBoss等。


# 设计组件

您可以根据下面的步骤来创建组件：

1.  在组件列表的工具栏点击「添加」按钮进入创建组件视图

2.  创建组件视图包含「基本信息」「属性」「脚本列表」「操作」「历史版本」「制品」

3.  在「基本信息」视图，您可以提供组件名称、组件版本、类型等信息，还可添加该组件的说明信息，和组件图标。勾选制品之后，可以通过「制品」标签页选择二进制软件制品仓库，进行软件版本的配置。具体步骤，参考[#关联主流制品库]。勾选实例化，勾选后该组件可通过“蓝图设计”进行编排。

>软件架构师可以通过组件管理界面管理组件。在左边导航选择「服务建模」-「软件组件」，右侧浏览区域出现所有组件列表。添加的软件组件，勾选实例化之后会出现在组件列表里以供选择组合组件，形成蓝图部署服务的编排。

  在「属性」视图，您可以添加组件的属性，添加完成后可将其作为参数传递给操作脚本，属性由主键、类型、默认值、备选项和描述组成。可在备选项中添加可选值，使得您在申请服务的时候，只能从默认值和备选项中定义的值中进行选择。可以创建要求使用字符、浮点数、密码、布尔或整数值的软件属性，支持设置校验规则，输入正则表达式则输入的属性参数必须接受表达式的校验。

>整数类型 : 对零以及正整数或负整数使用整数属性类型。布尔类型: 使用布尔属性类型在“值”下拉菜单中提供 True 和 False 这两个选项。


 在「脚本列表」视图，您可以通过创建新文件添加脚本文件。这些脚本文件应该和组件接口中的某个操作关联，或者被其它的脚本文件引用。同时，您可以添加文本文件，这些文本文件一般用来提供组件的配置信息。多次点击创建新文件可以添加多个文件，输入文件名、文件类型后点击操作-编辑内容，可以在右面编写文件内容。

## 操作

在「操作」视图，您可以将「脚本列表」视图中添加的脚本文件关联到组件的对应操作上，每个操作动作下实现-请选择下拉列表中选择这个操作对应的脚本文件。缺省的操作有配置、创建、删除、启动、停止。同时，您也可以在这里添加更多的组件操作，并且进行相应的脚本文件关联。添加组件操作点击操作右侧的添加按钮。所有必填项都添加好了之后，点击保存按钮生成新的组件，在组件列表上可以看到新添加的组件。添加组件的过程中随时点击「返回」按钮放弃添加组件。

生命周期操作 | 描述 | 示例 
:------:|:------:|:------:
创建 |     创建软件|     创建 Tomcat 服务，为“创建”生命周期操作编写的脚本将在首次安装软件时运行。
配置 |    配置软件| 配置Tomcat，设置 JAVA_OPTS 和 CATALINA_OPTS。配置脚本会在安装操作完成后运行。
启动 |   启动软件| 使用 Tomcat 服务器中的启动命令启动 Tomcat 服务。启动脚本会在配置操作完成后运行。
停止 |   停止软件| 使用 Tomcat 服务器中的停止命令停止 Tomcat 服务。停止脚本会在启动操作完成后运行。
删除 |   删除软件| 在应用程序中执行特定操作，然后再销毁部署。删除脚本会在销毁软件组件后运行。



## 版本管理

当您更新组件时，每次更新的版本将会被记录下来，支持回退到历史版本，具体操作步骤如下：

1.  组件列表的工具栏点击「任意组件」按钮进入软件组件视图

2.  在「历史版本」视图，您可以看到所有的历史版本，当您做出修改时，平台会默认记录您的历史版本信息包括：版本号、版本描述、创建人和创建时间

3.  您可以勾选相应的版本v1，点击「恢复版本」一键从版本v2回退到历史版本v1，点击「保存并同步」则同步组件信息。

4.  同时也支持一键删除任意历史版本，勾选要删除的版本，点击「删除」确认删除即删除成功。

## 关联主流制品库 {#关联主流制品库}

支持软件组件与主流制品库关联，支持对接Jfrog Artifactory, Nexus制品库匹配包管理平台，实现软件版本的更新
包管理工具的版本支持latest标记, 表示使用最新版本。

1. 在「制品」视图，您可以选择 端点、仓库（Jfrog Artifactory、Nexus）、组、名称、版本
2. 点击保存按钮，即可将组件与包管理平台进行关联。

# 组件管理
## 编辑组件

选中组件列表中某组件可以进入编辑组件视图。编辑组件和创建组件类似，为了保证已使用该组件创建的蓝图不会因为组件的更新而无法使用，在编辑时，组件每个子视图中都有一些项目不允许改动。编辑组件的过程中随时点击「返回」按钮放弃编辑组件。

## 导入组件

您可以根据以下步骤进行导入组件操作：

1.  在左边导航选择「服务建模」-「软件组件」

2.  点击「导入」按钮

3.  点击「浏览」，选择本地组件（ZIP格式），点击「提交」

4.  组件导入成功

## 导出组件

您可以根据以下步骤进行导出组件操作：

1.  在左边导航选择「服务建模」-「软件组件」

2.  选择组件列表中的某一组件，菜单栏上的「导出」按钮将变得可用，点击「导出」

3.  组件导出成功

## 复制组件

您可以根据以下步骤进行复制组件操作：

1.  在左边导航选择「服务建模」-「软件组件」

2.  选择组件列表中的某一组件，菜单栏上的「复制」按钮将变得可用，点击「复制」

3.  进入复制组件的编辑页面，可更改基本信息、属性、脚本列表以及节点接口信息。组件名字需要修改，组件不允许重名

## 删除组件

您可以根据下面的步骤来删除组件：

1.  在组件列表视图中，选中待删除组件

2.  在列表工具栏中点击「删除」按钮后，在确认对话框中确认后，组件会被删除

## Ansible组件

SmartCMP内置了Ansible类型基本组件，您可以根据需求为特定应用创建Ansible组件，创建方式与普通组件一致。

1.  编辑组件时，您可以在「属性」视图中添加playbook依赖的变量

2.  在「脚本列表」视图下创建playbooks文件。在playbook文件中，指定hosts为"local"。
    不需要指定remote user，也不需要创建Inventory文件

3.  多个组件之间传递变量通过playbook的blockinfile模块来实现

4.  在「节点接口」视图下，生命周期的"配置"、"启动"、"停止"、"删除"下拉框中选择需要执行的playbook主文件


