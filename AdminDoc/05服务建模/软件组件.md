**软件组件**

组件是构成蓝图的基本单元，SmartCMP已经内建了很多常用的组件，同时，您也可以使用SmartCMP创建、更新或删除组件。SmartCMP中的组件由属性和接口构成软件组件由脚本、属性、元数据、生命周期管理四项共同组成，具体概念如下：

-   脚本：生命周期的每个阶段都通过脚本来进行控制，得益于强大的底层类库，SmartCMP支持包括Shell,Powershell,Ruby,Python等语言，可以快速将应用的部署整合在云管平台内；

-   属性：不同应用系统对资源的需求和容量的控制都会有自定义要求，属性项可以按照不同系统的部署要求传递自定义参数。软件架构师可以通过设置自定义属性，将应用组件需要您填写的配置参数暴露在申请界面上，SmartCMP云管理平台会自动化调用相关参数执行应用的安装配置；

-   元数据：元数据包含应用组件本身的属性，主要包含应用组件版本，相关描述，常规继承关系，以及依赖的系统类型；

-   生命周期管理：SmartCMP云管理平台可以对应用系统的创建、配置、启动、停止、移除等过程进行完整的生命周期管理。通过脚本对应，完成从部署到到期卸载的所有软件配置工作。

-   软件架构师可以通过组件管理界面管理组件。在左边导航选择「服务建模」-「软件组件」，右侧浏览区域出现所有组件列表。

# 开箱即用组件

SmartCMP内置了企业常用的丰富组件：计算，网络，存储，应用软件部署，例如MySQL、Oracle等。还有一些常用的Web服务器，例如WebLogic，JBoss等。

# 创建组件

您可以根据下面的步骤来创建组件：

1.  在组件列表的工具栏点击「添加」按钮进入创建组件视图

2.  创建组件视图包含「基本信息」「历史版本」「属性」「文件列表」「节点接口」

3.  在「基本信息」视图，您可以提供组件继承于哪些类、类别、名称、组件版本、系统类型等信息，还可添加该组件的描述信息

4.  在「属性」视图，您可以添加组件的属性，属性由组件、类型、默认值、备选项和描述组成。可在备选项中添加可选值，使得您在申请服务的时候，只能从默认值和备选项中定义的值中进行选择。属性类型有：整数类型、浮点数类型、字符类型、布尔类型

5.  在「文件列表」视图，您可以通过创建新文件添加脚本文件。这些脚本文件应该和组件接口中的某个操作关联，或者被其它的脚本文件引用。同时，您可以添加文本文件，这些文本文件一般用来提供组件的配置信息。多次点击创建新文件可以添加多个文件，输入文件名、文件类型后点击操作-编辑内容，可以在右面编写文件内容。

6.  在「节点接口」视图，您可以将「文件列表」视图中添加的脚本文件关联到组件的对应操作上，每个操作动作下实现-请选择下拉列表中选择这个操作对应的脚本文件。缺省的操作有配置、创建、删除、启动、停止。同时，您也可以在这里添加更多的组件操作，并且进行相应的脚本文件关联。添加组件操作点击操作右侧的添加按钮。

7.  所有必填项都添加好了之后，点击保存按钮生成新的组件，在组件列表上可以看到新添加的组件。添加组件的过程中随时点击「返回」按钮放弃添加组件。

# 编辑组件

选中组件列表中某组件可以进入编辑组件视图。编辑组件和创建组件类似，为了保证已使用该组件创建的蓝图不会因为组件的更新而无法使用，在编辑时，组件每个子视图中都有一些项目不允许改动。编辑组件的过程中随时点击「返回」按钮放弃编辑组件。

# 导入组件

您可以根据以下步骤进行导入组件操作：

1.  在左边导航选择「服务建模」-「软件组件」

2.  点击「导入」按钮

3.  点击「浏览」，选择本地组件（ZIP格式），点击「提交」

4.  组件导入成功

# 导出组件

您可以根据以下步骤进行导出组件操作：

1.  在左边导航选择「服务建模」-「软件组件」

2.  选择组件列表中的某一组件，菜单栏上的「导出」按钮将变得可用，点击「导出」

3.  组件导出成功

# 复制组件

您可以根据以下步骤进行复制组件操作：

1.  在左边导航选择「服务建模」-「软件组件」

2.  选择组件列表中的某一组件，菜单栏上的「复制」按钮将变得可用，点击「复制」

3.  进入复制组件的编辑页面，可更改基本信息、属性、文件列表以及节点接口信息。组件名字需要修改，组件不允许重名

# 删除组件

您可以根据下面的步骤来删除组件：

1.  在组件列表视图中，选中待删除组件

2.  在列表工具栏中点击「删除」按钮后，在确认对话框中确认后，组件会被删除

# Ansible组件

SmartCMP内置了Ansible类型基本组件，您可以根据需求为特定应用创建Ansible组件，创建方式与普通组件一致。

1.  编辑组件时，您可以在「属性」视图中添加playbook依赖的变量

2.  在「文件列表」视图下创建playbooks文件。在playbook文件中，指定hosts为"local"。
    不需要指定remote user，也不需要创建Inventory文件

3.  多个组件之间传递变量通过playbook的blockinfile模块来实现

4.  在「节点接口」视图下，生命周期的"配置"、"启动"、"停止"、"删除"下拉框中选择需要执行的playbook主文件

# 版本管理

当您更新组件时，每次更新的版本将会被记录下来，支持回退到历史版本，具体操作步骤如下：

1.  组件列表的工具栏点击「任意组件」按钮进入软件组件视图

2.  软件组件视图包含「基本信息」「历史版本」「属性」「文件列表」「节点接口」

3.  在「历史版本」视图，您可以看到所有的历史版本，当您做出修改时，平台会默认记录您的历史版本信息包括：版本号、版本描述、创建人和创建时间

4.  您可以勾选相应的版本v1，点击「恢复版本」一键从版本v2回退到历史版本v1，点击「保存并同步」则同步组件信息。

5.  同时也支持一键删除任意历史版本，勾选要删除的版本，点击「删除」确认删除即删除成功。
