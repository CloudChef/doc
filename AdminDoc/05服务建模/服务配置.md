
**服务配置**

SmartCMP云管平台从组件的定义，到应用的可视化拓扑建模，并将服务配置标准化，再到基于蓝图和配置的自动化部署，最终生成一个符合TOSCA规范的云资源蓝图服务。支持管理员将设计好的蓝图发布为服务，在服务配置处配置基本信息、构成蓝图的组件详细参数、输入与输出、可以将服务与企业内部的流程（例如：审批流程）集成之后发布到服务目录。服务项主要功能有：

 + 服务与一个、多个或全部蓝图关联，服务与业务组关联，选定服务类型（云资源蓝图服务、手工工单服务、执行任务服务等等）

 + 服务与服务策略关系，如服务时间、租期、服务流程等

 + 服务访问权限设置，配置部署操作许可，指定操作权限

 + 服务与流程集成，如审批流程、云服务部署流程等等

具体操作步骤如下文：在左边导航选择「服务建模」-「服务配置」，出现服务列表，列表中显示服务名称、描述、蓝图设计、业务组、状态、服务部署数量、创建时间等，可对服务配置做如下操作：添加、编辑、取消发布、删除等。

>「Note」服务发布完成之后，可以通过服务目录进行服务申请，具体操作方法参考：[服务目录申请](https://cloudchef.github.io/doc/AdminDoc/06云服务管理/#服务目录申请)

# 添加服务配置

您可以根据下面步骤添加服务配置：

1.  在左边导航栏选择「服务建模」-「服务配置」，点击「添加」

2.  填写服务名称、服务描述（选填）、选择业务组，服务类型，当选择服务类型为云资源蓝图服务时，增选蓝图设计，选择关联一个、多个、或全部蓝图，当选择手工工单服务是，增选流程选择，点击「提交」

 接下来为您介绍云资源蓝图服务配置和手工工单服务配置的具体步骤。

>「Note」服务配置的服务描述支持Markdown语法书写规则，从而在服务申请时候展示不同服务描述的展示格式

## 概况

在「概况」标签页填入下列信息：服务项名称、服务项描述、	服务项logo选择，发布后将在服务目录处显示、业务组名称
（服务配置可设置在某个业务组，或共享给所有业务组；当共享给所有业务组时，有些设置无法在服务配置时指定，将在用户申请服务时，指定某个业务组后，根据选中业务组上的资源而决定），状态(只读)服务项状态（已发布：将服务项发布到服务目录；未发布：服务项未发布状态；已过期：服务项已过期）
+ 服务部署租用时间（日）	服务部署租用时间到后，部署里的所有云主机会停机。可配置的租用时间在业务组配置的区间范围内设置，勾选「允许修改」和「仅审批时可修改」。

+ 服务部署保留时间（日）	保留时间，保留时间到后，部署会被卸除。可配置的保留时间在业务组配置的区间范围内设置，勾选「允许修改」和「仅审批时可修改」。

+ 启用关联规则	支持将vSphere虚拟机强制分散到不同的物理机或聚合到同一台物理机上。允许申请时添加软件	勾选后，服务发布成功后，服务申请时将允许该服务在申请时候添加软件

点击「输入与输出」：可添加输入输出参数，服务部署成功后，可在详情页面进行查看相关输出数据。输入：点击添加，填写名称（必填）、描述、默认值等输入信息。 输出：点击添加，填写名称（必填）、描述、表达式（必填）等输出信息。表达式可选择已有，也可根据需求自行输入。

点击「审批配置」标签页，选择审批流程（内置的默认审批流程或自定义的审批流程，例如：平行审批流程）、查看审批流程图、审批流程步骤

点击「流程配置」标签页，选择服务流程（内置的标准云服务部署流程或自定义的服务流程），查看服务流程图、服务流程步骤

点击「表单配置」标签页，选择表单、进行表单预览

点击「部署操作许可」视图：在此可启用服务部署管理中的各项操作，以及配置所需的审批流程。对于每个操作，可针对不同的角色，配置不同的规则和审批流程。默认继承业务组配置，可增删，可对操作列表进行角色筛选

## 组件配置

点击「组件配置」标签页，可看到配置服务中的蓝图拓扑和所有组件：

组件配置列表中有三种类型的组件，分别为：计算组件、软件组件、网络组件。计算组件：一般指服务器或计算节点，如Server、WindowsServer、InstanceD等， 软件组件：一般是放在服务器或者计算节点上的应用，例如：Apache、MySQL、Tomcat等， 网络组件：一般指服务器的网络配置，如network

组件配置：

 - 计算组件配置：可以通过选择有启用监控的虚拟机模板来给当前节点或服务器添加监控

 - 软件组件：可以添加相应的监控点来启用监控，软件组件所在的节点必须启用监控，软件组件的监控才会生效。当带监控的服务器或节点和软件组件部署成功后，可以在部署详情页面的监控标签页查看当前部署的监控数据信息。对应的节点云主机详情页面也会有节点的监控标签页以供用户监控当前节点的数据。同时，如果当前节点中安装了带监控点的软件组件，则可以通过添加监控点来查看软件组件的监控数据

 - 软件组件节点详细设置，与制品库相关联的设置，选择组、软件组件名称、版本。


云资源配置：服务配置中，配置云主机节点的云资源配置，需要注意资源池选择策略，平台主要提供以下几种策略：
+ 手工指定：手工指定资源池，若资源池选择策略选择“手工指定”，支持使用资源标签，缩小选择范围，将出现“资源池”选择项，在下拉框中选择资源池，指定资源池，可选择勾选「允许修改」和「仅审批时可修改」。
+ 自动选择剩余容量最大的：平台自动按照策略选择当前可选择的资源池，资源使用量最小，剩余容量最大的。
+ 自动选择费用最低的：平台支持设置资源计费规则，按照策略选择当前可选择的资源池，费用最低 花费最少的。
+ 平均分配：服务部署的时， 资源是平均分配到不同的资源池， （平均分配的前提是选择的资源池有足够的资源。）

>「Note」资源标签来源于管理员在「基础设施」-「资源标签」中配置完成，具体配置参考，请参考：[资源标签](https://cloudchef.github.io/doc/AdminDoc/03基础设施管理/资源标签.html) 根据标签选择匹配该标签的资源池，实现将应用部署到特定的资源池。

## 部署操作许可{#部署操作许可}

部署操作许可规定了对该服务部署成功后可启用服务部署管理中的各项操作，以及配置所需的审批流程。对于每个操作，可针对不同的角色，配置不同的启用规则和审批流程。

1.  点击左侧导航栏「服务建模」-「服务配置」，点击服务部署名称，进入服务部署页面。

2.  点击「服务部署操作许可」标签页，在此可配置服务部署中的各项操作，以及配置所需的审批流程。对于每个操作，可针对不同的角色，配置不同的启用规则和审批流程。

>「Note」服务部署操作许可列表由业务组服务部署操作许可继承而来，不勾选「继承业务组配置」可在此范围内删减许可。

1.  若勾选「继承业务组配置」，则与在业务组中的服务部署操作配置相同

2.  若不勾选「继承业务组配置」，在每项操作后进行编辑，选择启用状况，最后点击「保存」



# 配置云资源蓝图服务
## 配置vSphere单节点服务 {#配置vSphere单节点服务}

1.  在左侧导航点击「服务建模」-「服务配置」，点击左上角的「添加」进入新建服务配置界面，依次填写服务名称，服务描述（选填），蓝图设计（选择[创建的vSphere单节点蓝图](https://cloudchef.github.io/doc/AdminDoc/05服务建模/蓝图设计.html#创建vSphere单节点蓝图)，业务组，点击「提交」

2.  「概况」「输入与输出」和「服务部署操作许可」视图配置请参照[概述]

3.  「组件配置」视图：可以看到vSphere服务拓扑图以及服所有组件：Server、Network

 + Server：点击Server名称，进入节点详细设置，共有「概况」「服务器配置」「网络」「用户」「磁盘」「关系」「操作许可」等标签页

「概况」页面：

 
+ 基本信息     展示server的类型、类别和名称等基本信息
+ 云主机数量   选择部署的云主机数量

 >「Note」勾选「允许修改」和「仅审批时可修改」。这里存在两种情况：如果勾选一项「允许修改」，则用户在请求服务时，可以进行修改参数云主机数量，在服务审批阶段也可以进行修改参数云主机数量；如果勾选两项项「允许修改」和「仅审批时可修改」，则用户在请求服务时，不可以进行修改参数云主机数量，只在服务审批阶段允许进行修改参数云主机数量；
 
 
 「服务器配置」页面：
计算资源
+ OS主机名（Hostname）	没有定义时默认继承业务组命名规则，勾选「允许修改」和「仅审批时可修改」。这里存在两种情况：
1. 如果勾选一项「允许修改」，则用户在请求服务时，可修改参数，在服务审批阶段也可修改参数；
2. 如果勾选两项「允许修改」和「仅审批时可修改」，用户在服务请求中，不可修改参数，只在服务审批阶段允许修改参数；
+ 云主机名称	没有定义时默认继承业务组命名规则，勾选「允许修改」和「仅审批时可修改」。
+ 注释	选填，勾选「允许修改」和「仅审批时可修改」。
+ AD域（Windows服务）：AD域	勾选后，填写AD域名和用户姓名、密码。该服务部署后的虚机将加进AD域里

模板设置
+ 操作系统名称	选择Linux/Windows操作系统
+ 虚拟机模板	选择该操作系统下的vSphere虚拟机模板
+ 计算规格配置
+ 计算规格模式	计算规格模式定义了云主机CPU和内存的配置方式。“自定义”允许直接输入数字，“固定规格”将按照管理员配置的计算规格进行选择
+ vCPU数量	若计算规格模式选择自定义，输入vCPU数量，勾选「允许修改」和「仅审批时可修改」。
+ 内存（GB）	若计算规格模式选择自定义，输入内存，勾选「允许修改」和「仅审批时可修改」。
+ 计算规格	若计算规格模式选择固定规格，选择规格，勾选「允许修改」和「仅审批时可修改」。
+ 在「系统管理」-「计算规格」中配置相关的计算规格

系统盘配置

+ 置备模式	（选择完全克隆的虚拟机模板才会出现该选项，即选择虚拟机虚拟磁盘的磁盘格式）支持三种置备模式：精简置备、厚置备延迟置零、厚置备置零。

>「Note」 厚置备延迟置零格式，以默认的厚格式创建虚拟磁盘。创建虚拟磁盘时分配虚拟磁盘所需的空间。创建时不会擦除物理设备上保留的数据，但是从虚拟机首次执行写入操作时会按需要将其置零。

>「Note」 厚置备置零，是一种厚虚拟磁盘类型，支持诸如 Fault Tolerance 等群集功能。在创建时为虚拟磁盘分配所需的空间。与常规格式相反，创建虚拟磁盘后，会将物理设备上保留的数据置零。创建这种格式的磁盘所需的时间可能会比创建其他类型的磁盘所需的时间更长。

>「Note」 精简置备格式，可节省存储空间。最初，精简置备的磁盘只使用该磁盘最初所需要的数据存储空间。如果以后精简磁盘需要更多空间，则它可以增长到为其分配的最大容量。


+ 文件夹	虚机会部署在选中的vCenter文件夹里，支持申请时改变需要在「资源池」—「云平台资源信息」中选择文件夹
+ 数据存储策略	（选择完全克隆的虚拟机模板才会出现该选项）默认选择数据存储默认值，下拉可选择VMware vCenter中配置好的存储策略，支持勾选「允许修改」和「仅审批时可修改」。
+ 存储	虚机会部署在选中的存储里，存储会根据选择的存储策略判定兼容性，以及显示该存储的空余空间、总空间以及占比。若不选，则部署在资源池定义的存储里允许用户添加新磁盘时选择置备模式和存储	选择是否允许，若不允许，新磁盘的置备模式和存储的选择将与系统盘保持一致



 + 「网络」页面配置访问域（选填）和DNS服务器（选填）；IP分配方式根据资源池中的配置指定，可在Network节点中选择不同的网络标签

 + 「用户」视图（Linux服务）：可以添加Linux用户和用户组，一个用户可以有多个用户组，一个用户组可以有多个用户，虚拟机部署成功后，将会有对应的用户和组被创建，用户可以选择是否设置为sudoer。注意：只有安装了代理（部署时安装），才出现用户标签页面

 + 「磁盘」视图：可以配置Linux虚拟机逻辑卷。除了直接创建硬盘分区外，还可以选择创建逻辑卷

<!-- -->

 + 要创建逻辑卷（LV），需要先创建卷组（VG），然后往卷组中添加物理卷（PV）作为卷组底层资源，然后才能创建逻辑卷，一个卷组上创建的逻辑卷的总大小需不大于该卷组的资源总大小。物理卷可以勾选swap选项以创建swap分区

 + 添加/更改磁盘（物理卷PV）：存储为空的时候，图标变为绿色，表示部署时允许添加磁盘。添加的磁盘需要填写大小和置备模式（目前为必选项），挂载点、卷组、数据存储名选填

<!-- -->

 + 「关系」视图：可选择可以关联的虚拟机

 + 「操作许可」视图：为某服务项添加云资源操作许可]

<!-- -->

 + 「Network」组件：点击network名称，进入节点详细设置，共有「概况」「属性」两个标签页

<!-- -->

 + 「概况」页面：可查看Network组件类型、类别、名称

 + 「属性」页面：可选择网络标签以及管理网络，网络标签支持勾选「允许修改」和「仅审批时可修改」。

4.  「服务部署操作许可」视图：在此可启用服务部署管理中的各项操作，以及配置所需的审批流程。对于每个操作，可针对不同的角色，配置不同的规则和审批流程。默认继承业务组配置，可增删，可对操作列表进行角色筛选

5.  点击「保存」，返回组件列表界面。点击「验证」，验证成功后，「保存并发布」该服务，vSphere虚拟机服务配置并发布成功

## 配置VMware NSX服务 {#配置VMwareNSX服务}

 配置带NSX云平台的vSphere服务，配置服务前操作：

1.  确保该业务组已添加vSphere云平台和VMware
    NSX云平台，并在vSphere云平台处添加与VMware NSX云平台的关联关系

2.  在vSphere资源池中，关联VMware
    NSX的传输区域（将影响「NSX逻辑交换机」的显示）

3.  关联成功后，在「资源池」- vSphere资源池
    -「网络资源」中看到「NSX逻辑交换机」「NSX逻辑路由器」「安全策略组」三个额外标签页

 + 配置「NSX逻辑交换机」，选择交换机并分配资源池（网络资源与NSX逻辑交换机至少配置一种）

 + 配置「NSX逻辑路由器」，选择DLR加入该资源池

 + 配置「安全策略组」，勾选已有的安全策略组

4.  点击「保存」，VMware NSX资源池配置成功

开始配置VMware NSX虚拟机服务：

1.  「服务建模」-「服务配置」-「添加」，填写服务名称，选择在[VMware
    NSX蓝图](https://cloudchef.github.io/doc/AdminDoc/05服务建模/蓝图设计.html#创建VMwareNSX蓝图)，选择业务组，点击「提交」

2.  「基本信息」「输入与输出」和「服务部署操作许可」视图配置请参照[概述]
3.  点击「组件配置」，可看到VMware
    NSX蓝图拓扑图和所有组件：Lswitch、Server、SecurityGroup、DLR，「Server」组件：配置同6.3.3.1 vSphere服务一样，「Lswitch」组件，点击Lswitch名称，进入「节点详细设置」页面：共有「基本信息」「属性」两个标签页

基本信息」页面：查看Lswitch的基本信息，如类型、类别和名称

属性」页面： 属性（不勾选使用已有网络） 
+ IP分配方式                   支持IP池和手工指定，若选择IP池，需指定IP池
+   复制模式                     选择单播。支持单播、多播和混合三种方式
+   管理网络                     勾选是否管理网络
+   属性（勾选使用已有网络）     
+   网络标签                     从已有的网络中选择，勾选「允许修改」和「仅审批时可修改」。（需要在vSphere with NSX资源池中，选择NSX逻辑交换机）
+   IP分配方式                   支持IP池、DHCP、手工指定三种方式
+   管理网络                     勾选是否管理网络

「DLR」组件，点击DLR名称，进入「节点详细设置」页面：共有「基本信息」「属性」两个标签页

「基本信息」页面：查看DLR的基本信息，如类型、类别和名称

「属性」页面：选择一个已有的逻辑路由器（DLR）（在资源池中选择NSX逻辑路由器）；可增加接口配置



「SecurityGroup」组件，点击SecurityGroup名称，进入「节点详细设置」页面：共有「基本信息」「属性」两个标签页



「基本信息」页面：查看SecurityGroup的基本信息，如类型、类别和名称

「属性」页面： 属性（不勾选使用已有安全组）   
 
+  名称                           新建安全组，填写安全组的名称，勾选「允许修改」和「仅审批时可修改」。
+   描述                           填写安全组相关描述信息（选填）
+   属性（勾选使用已有安全组）       安全组                         从已有的安全组中选择一个，需要在资源池「安全策略组」中选择一个或多个安全策略用于该资源池

4.  点击「保存」，返回组件列表界面。点击「验证」，验证成功后，「保存并发布」该服务，VMware
    NSX服务配置并发布成功

## 配置vSphere MySQL带监控服务 {#配置vSphereMySQL带监控服务}

1.  在左侧导航点击「服务建模」-「服务配置」，点击左上角的「添加」进入新建服务配置界面，依次填写服务名称，服务描述（选填），蓝图设计（选择[创建的vSphereMySQL带监控蓝图](https://cloudchef.github.io/doc/AdminDoc/05服务建模/蓝图设计.html#创建vSphereMySQL带监控蓝图)，业务组，点击「提交」

2.  「基本信息」「输入与输出」和「服务部署操作许可」视图配置请参照[概述]

3.  「组件配置」视图：可以看到vSphere服务拓扑图以及服所有组件：Server、Network

 + 「Server」： 配置同vSphere服务一样（需选择带自动化代理的虚拟机模板）

 + 「Network」：配置同vSphere服务一样

 + 「MySQL」：
    点击MySQL名称，进入节点详细设置，共有「基本信息」「属性」「关系」等标签页

<!-- -->

 + 「基本信息」页面：展示MySQL的类型、类别和名称等基本信息

 + 「属性」页面：展示MySQL主键相关信息，来源于「服务建模」-「软件组件」中的配置

 + 「关系」页面：展示Server与MySQLExporter之间的关系

<!-- -->

 + 「MySQLExporter」：
    点击MySQLExporter名称，进入节点详细设置，共有「基本信息」「属性」「关系」等标签页

<!-- -->

 + 「基本信息」页面：展示MySQLExporter的类型、类别和名称等基本信息

 + 「属性」页面：展示MySQLExporter主键相关信息，来源于「服务建模」-「软件组件」中的配置，若未填写package_url，需填写地址

 + 「关系」页面：展示Server与MySQLExporter之间的关系

4.  点击「保存」，返回组件列表界面。点击「验证」，验证成功后，「保存并发布」该服务，vSphere
    MySQL带监控服务配置并发布成功

## 配置OpenStack单节点服务 {#配置OpenStack单节点服务}

1.  在左侧导航点击「服务建模」-「服务配置」，点击左上角的「添加」进入新建服务配置界面，依次填写服务名称，服务描述（选填），蓝图设计（选择[创建的OpenStack单节点蓝图](https://cloudchef.github.io/doc/AdminDoc/05服务建模/蓝图设计.html#创建OpenStack单节点蓝图)，业务组，点击「提交」

2.  「概况」「输入与输出」和「服务部署操作许可」视图配置请参照[概述]

3.  「组件配置」视图：可以看到OpenStack
    单节点服务拓扑图以及服所有组件：Server、Network

 + Server：点击Server名称，进入节点详细设置，共有「概况」「属性」「网络资源」「用户」「磁盘」「安全策略组」「关系」「操作许可」等标签页

<!-- -->

 + 「概况」页面：

 
- 基本信息	展示server的类型、类别和名称等基本信息
- 资源池选择策略
1. 自动选择：平台自动按照策略选择资源池
2. 基于资源标签选择：若该服务所使用的蓝图中已有资源便签，默认继承该资源标签，根据标签去选择业务组中匹配该标签的资源池（前提是资源池已设置资源标签），实现将资源部署到特定的资源池中。也可在服务配置选择其他资源标签；勾选「允许修改」和「仅审批时可修改」。
3.	手工指定：可选择为该服务手工指定资源池，若 资源池选择策略选择“手工指定”后，将出现资源池选择项，指定资源池，允许资源池申请时改变
>「Note」若该服务共享给全部业务组，则资源池无法指定，默认强制勾选「允许修改」和「仅审批时可修改」。；若该服务指定给某一业务组，则选择该业务组下的资源池
- 云主机数量	选择部署的云主机数量，勾选「允许修改」和「仅审批时可修改」。

   「属性」页面：


 + OS主机名       没有定义时默认继承业务组命名规则，勾选「允许修改」和「仅审批时可修改」。
 + 云主机名称     没有定义时默认继承业务组命名规则，勾选「允许修改」和「仅审批时可修改」。
 + 操作系统名称   选择Linux操作系统
 + 虚拟机模板     选择Linux操作系统下的OpenStack虚拟机模板
 + 卷类型         若选择从云硬盘启动或从云硬盘快照启动的虚拟机模板，则会出现该选项，选择OpenStack云平台上已存在的卷类型，也可选择"未设置卷类型"
 + 卷大小         若选择从云硬盘启动或从云硬盘快照启动的虚拟机模板，则会出现该选项，卷大小需大于等于镜像要求的磁盘大小，选填
 + 主机集合       虚机会部署到选择的主机中
 + 虚拟机规格     选择部署的虚拟机CPU和内存规格，支持勾选「允许修改」和「仅审批时可修改」。

 + 「网络资源」页面可配置DNS：DNS名称、DNS域、DNS类型（仅支持A类型）、DNS服务器（勾选「允许修改」和「仅审批时可修改」。
 + 「用户」视图（Linux服务）：可以添加Linux用户和用户组，一个用户可以有多个用户组，一个用户组可以有多个用户，虚拟机部署成功后，将会有对应的用户和组被创建，用户可以选择是否设置为sudoer。注意：只有安装了代理（部署时安装），才出现用户标签页面

 + 「磁盘」页面：可以配置Linux虚拟机逻辑卷。除了直接创建硬盘分区外，还可以选择创建逻辑卷（如果需要配置逻辑卷管理（LVM），请确保在虚拟机模板中安装自动化代理）

<!-- -->

 + 要创建逻辑卷（LV），需要先创建卷组（VG），然后往卷组中添加物理卷（PV）作为卷组底层资源，然后才能创建逻辑卷，一个卷组上创建的逻辑卷的总大小需不大于该卷组的资源总大小。物理卷可以勾选swap选项以创建swap分区

 + 添加/更改磁盘（物理卷PV）：存储为空的时候，点击，表示部署时允许添加磁盘。添加的磁盘需要填写大小和置备模式（目前为必选项），挂载点、卷组、数据存储名选填

<!-- -->

 + 「安全策略组」页面：可选择虚拟机的安全策略组

 + 「关系」页面：可选择可以关联的虚拟机

 + 「操作许可」页面：
    为某服务项添加云资源操作许可

<!-- -->

 + 「Network」组件：点击network名称，进入节点详细设置，共有「基本信息」「属性」两个标签页

<!-- -->

 + 「基本信息」页面：可查看Network组件类型、类别、名称

 + 「属性」页面：可选择网络、子网、IP分配方式（根据网络和子网的选择，读取资源池中的配置）以及管理网络，网络和子网勾选「允许修改」和「仅审批时可修改」。

4.  点击「保存」，返回组件列表界面。点击「验证」，验证成功后，「保存并发布」该服务，OpenStack
    单节点服务配置并发布成功

## 配置OpenStack Firewall服务{#配置OpenStackFirewall服务} 

1.  在左侧导航选择「服务建模」-「服务配置」，点击左上角的「添加」进入新建服务配置界面，依次填写服务名称，服务描述（选填），蓝图设计（选择[ OpenStack Firewall蓝图](https://cloudchef.github.io/doc/AdminDoc/05服务建模/蓝图设计.html#创建OpenStackFirewall蓝图)，业务组，点击「提交」
2.  「基本信息」「输入与输出」和「服务部署操作许可」视图配置请参照[概述]

3.  「组件配置」视图：可以看到OpenStack
    Firewall服务拓扑图以及Firewall组件

   「基本信息」页面：可查看Firewall组件类型、类别、名称；   「属性」页面：
 
+ 名称	防火墙名称（勾选「允许修改」和「仅审批时可修改」。这里存在两种情况：如果勾选一项「允许修改」，则用户在请求服务时，可修改参数，在服务审批阶段也可修改参数；如果勾选两项「允许修改」和「仅审批时可修改」，用户在服务请求中，不可修改参数，只在服务审批阶段允许修改参数；）
+ 描述	选填
+ 管理员状态	启用、禁用，默认启用
+ 路由	只允许用户在申请时候选择，需要在配置OpenStack资源池时添加路由勾选“使用已有策略”	选择已有策略，勾选「允许修改」和「仅审批时可修改」。这里存在两种情况：如果勾选一项「允许修改」，则用户在请求服务时，可修改参数，在服务审批阶段也可修改参数；如果勾选两项「允许修改」和「仅审批时可修改」，用户在服务请求中，不可修改参数，只在服务审批阶段允许修改参数；不勾选“使用已有策略”	新建策略，填写策略名称（必填），策略描述（选填），选择是否“共享的”和“已审计”。	若勾选“共享的”，在对Firewall做运维操作「更新防火墙策略」时，只能选择已共享的策略及其策略下的规则；	若未勾选“共享的”，在对Firewall做运维操作「更新防火墙策略」时，可选择“共享的”和“未共享的“策略及其策略下的规则
+ 资源池选择策略	支持资源池选择策略
+ 资源池	当一个业务组关联多个OpenStack资源池时，支持选择具体使用哪个资源池的资源
+ 属性（勾选使用已有防火墙） 
+ 防火墙	从已有防火墙中选择一个，勾选「允许修改」和「仅审批时可修改」。这里存在两种情况：如果勾选一项「允许修改」，则用户在请求服务时，可修改参数，在服务审批阶段也可修改参数；如果勾选两项「允许修改」和「仅审批时可修改」，用户在服务请求中，不可修改参数，只在服务审批阶段允许修改参数；
+ 资源池选择策略	支持资源池选择策略
+ 资源池	当一个业务组关联多个OpenStack资源池时，支持选择具体使用哪个资源池的资源



4.  点击「保存」，返回组件列表界面。点击「验证」，验证成功后，「保存并发布」该服务，OpenStack
    Firewall虚拟机服务配置并发布成功

## 配置OpenStack LoadBalancer with SecuriryGruop服务{#配置OpenStackLoadBalancerWithSecuriryGruop服务}
1.  在左侧导航选择「服务建模」-「服务配置」，点击左上角的「添加」进入新建服务配置界面，依次填写服务名称，服务描述（选填），蓝图设计（选择[OpenStack LoadBalancer with SecurityGroup蓝图](https://cloudchef.github.io/doc/AdminDoc/05服务建模/蓝图设计.html#创建OpenStackLoadBalancerSecurityGroup蓝图)，业务组，点击「提交」

2.  「基本信息」「输入与输出」和「服务部署操作许可」视图配置请参照[概述]

3.  「组件配置」视图：可以看到OpenStack LoadBalancer with
    SecuriryGruop服务拓扑图以及所有组件：Server、Network
    、LoadBalancer、Listener、SecurityGroup

 + Server：Server节点的配置参照[
    配置OpenStack单节点服务](https://cloudchef.github.io/doc/AdminDoc/05服务建模/蓝图设计.html#创建OpenStack单节点蓝图)

 + Network：Network节点的配置参照[配置OpenStack单节点服务]()

 + LoadBalancer：点击LoadBalancer名称，进入节点详细设置，共有「基本信息」和「属性」两个标签页

<!-- -->

 + 「基本信息」：显示类型、类别、名称等基本信息

 + 「属性」页面

+ 属性（不勾选使用已有资源） 
+ 服务提供商	选择LoadBalancer的服务提供商（Provider），支持F5和HA
+ 名称	填写名称（必填），勾选「允许修改」和「仅审批时可修改」。
+ 描述	选填
+ DNS名称	仅支持请求服务时填写，如需指定DNS请勾选允许申请时更改，若勾选允许申请时修改，DNS服务器将必填，DNS类型为A
+ DNS域	选填，勾选「允许修改」和「仅审批时可修改」。
+ DNS服务器	选填，勾选「允许修改」和「仅审批时可修改」。
+ DNS类型	选填，勾选「允许修改」和「仅审批时可修改」。

+ 属性（勾选使用已有资源） 
+ 服务提供商	选择LoadBalancer的服务提供商（Provider），支持F5和HA
+ 名称	填写名称（必填），勾选「允许修改」和「仅审批时可修改」。
+ DNS名称	仅支持请求服务时填写，如需指定DNS请勾选允许申请时更改若勾选允许申请时修改，DNS服务器将必填，DNS类型为A
+ DNS域	选填，勾选「允许修改」和「仅审批时可修改」。
+ DNS服务器	选填，勾选「允许修改」和「仅审批时可修改」。
+ DNS类型	选填，勾选「允许修改」和「仅审批时可修改」。


 + Listener：点击Listener名称，进入节点详细设置，共有「基本信息」「属性」「成员」「策略和规则」四个标签页

<!-- -->

 + 「基本信息」：显示类型、类别、名称等基本信息

 + 「属性」页面

  属性（不勾选使用已有资源）   
+ 名称                         填写名称（必填），勾选「允许修改」和「仅审批时可修改」。
+   描述                         选填
+   协议                         选择协议（选填），支持HTTP、TCP、UDP，勾选「允许修改」和「仅审批时可修改」。
+   端口                         填写端口号（必填），如80，勾选「允许修改」和「仅审批时可修改」。
+   流量分发算法                 选择一个算法（选填），勾选「允许修改」和「仅审批时可修改」。
+   属性（勾选使用已有资源）     
+   名称                         填写名称（必填），勾选「允许修改」和「仅审批时可修改」。

 + 「成员」页面：内部成员和外部成员，内部成员列出当前蓝图中所有和该Listener节点相关联的server/windowsServer；外部成员，可添加外部成员，填写IP地址（必填）、子网（必填）、端口（必填）、权重等

 + 「健康监控」页面：

<!-- -->

 + 监控类型：支持多种监控类型，如HTTP、HTTPS、TCP等，勾选「允许修改」和「仅审批时可修改」。

 + 时间间隔（秒）：必须大于等于1，勾选「允许修改」和「仅审批时可修改」。

 + 最大重试次数：1\~10，勾选「允许修改」和「仅审批时可修改」。

 + 超时（秒）：超时（秒）必须小于等于时间间隔（秒），勾选「允许修改」和「仅审批时可修改」。

 + HTTP方法：若监控类型选择HTTP，将选择HTTP方法。如GET、POST等，勾选「允许修改」和「仅审批时可修改」。

 + 期望的状态码：若监控类型选择HTTP，将填写期望的状态码

 + URL路径：
    若监控类型选择HTTP，将填写URL路径，勾选「允许修改」和「仅审批时可修改」。

<!-- -->

 + 「策略和规则」页面：可新建应用于该Listener的策略和规则，勾选「允许修改」和「仅审批时可修改」。；添加策略，填写名称，选择操作，描述（选填），权重，重定向URL

<!-- -->

 + SecurityGroup：点击SecurityGroup名称，进入节点详细设置，共有「基本信息」和「属性」两个标签页

<!-- -->

 + 「基本信息」：显示类型、类别、名称等基本信息

 + 「属性」页面：默认"使用已有安全组"，选择一个安全组

>「Note」OpenStack资源池中，在「网络资源」-「安全策略组」中需要选择一个安全策略组后，才能在SecurityGroup「属性」页面选择一个已有的安全组

4.  点击「保存」，返回组件列表界面。点击「验证」，验证成功后，「保存并发布」该服务，OpenStack
    LoadBalancer with SecuriryGruop虚拟机服务配置并发布成功

## 配置OpenStack FloatingIP服务 {#配置OpenStackFloatingIP服务}

1.  在左侧导航选择「服务建模」-「服务配置」，点击左上角的「添加」进入新建服务配置界面，依次填写服务名称，服务描述（选填），蓝图设计（选择[OpenStack FloatingIP蓝图]()，业务组，点击「提交」

2.  「基本信息」「输入与输出」和「服务部署操作许可」视图配置请参照[概述]

3.  「组件配置」视图：可以看到OpenStack
    FloatingIP服务拓扑图及组件FloatingIP

 + FloatingIP：点击LoadBalancer名称，进入节点详细设置，共有「基本信息」和「属性」两个标签页

<!-- -->

 + 「基本信息」：显示类型、类别、名称等基本信息

 + 「属性」页面

  属性（不勾选使用已有资源）   
  
+ 网络                         选择FloatingIP的网络，勾选「允许修改」和「仅审批时可修改」。
+ 子网                         选择FloatingIP网络对应的子网，勾选「允许修改」和「仅审批时可修改」。
+   IP分配方式                   选择IP分配方式，支持IP池、DHCP、手工指定，若选择手工指定，则需在服务申请时指定IP地址
+  IP池                         若选择IP池的分配方式，选择IP池
+   DNS名称                      仅支持请求服务时填写，如需指定DNS请勾选允许申请时更改
+   DNS域                        选填，勾选「允许修改」和「仅审批时可修改」。
+   DNS服务器                    选填，勾选「允许修改」和「仅审批时可修改」。
+   DNS类型                      选填，勾选「允许修改」和「仅审批时可修改」。
+   属性（勾选使用已有资源）     
+   浮动IP                       选择FloatingIP的网络，勾选「允许修改」和「仅审批时可修改」。

4.  点击「保存」，返回组件列表界面。点击「验证」，验证成功后，「保存并发布」该服务，OpenStack
    FloatingIP虚拟机服务配置并发布成功

## 配置OpenStack DNS服务 {#配置OpenStackDNS服务}

1.  在左侧导航选择「服务建模」-「服务配置」，点击左上角的「添加」进入新建服务配置界面，依次填写服务名称，服务描述（选填），蓝图设计（选择[OpenStack DNS蓝图](https://cloudchef.github.io/doc/AdminDoc/05服务建模/蓝图设计.html#创建OpenStackDNS蓝图)，业务组，点击「提交」

2.  「基本信息」「输入与输出」和「服务部署操作许可」视图配置请参照[概述]

3.  「组件配置」视图：可以看到OpenStack DNS服务拓扑图及组件DNS

 + DNS：点击DNS名称，进入节点详细设置，共有「基本信息」和「属性」两个标签页

<!-- -->

 + 「基本信息」：显示类型、类别、名称等基本信息

 + 「属性」页面


+ DNS类型	支持A、CNAME、MX、TXT 4种类型
•	A记录：WEB服务器的IP指向，用来指定主机名（或域名）对应的IP地址记录
•	CNAME记录：别名解析
•	MX记录：邮件交换记录
•	TXT记录：某个主机名或域名的说明
+ MX优先级	如果DNS类型选择MX，将出现「MX优先级」这个菜单
+ DNS名称	输入DNS的名称，默认强制允许申请时更改
+ DNS域	选择DNS域，在系统配置中添加的DNS域
+ DNS服务器	根据所在业务组的OpenStack云平台服务器中配置的DNS服务器选择
+ DNS参数	若DNS类型选择的A：填写IP地址，支持多条，用逗号分隔；
+ 若DNS类型选择的CNAME：输入域名，例test.example.com
+ 若DNS类型选择的MX：输入域名，例test.example.com
+ 若DNS类型选择的TXT：输入一段描述


4.  点击「保存」，返回组件列表界面。点击「验证」，验证成功后，「保存并发布」该服务，OpenStack
    DNS虚拟机服务配置并发布成功

## 配置Kubernetes服务 {#配置Kubernetes服务}

1.  在左侧导航选择「服务建模」-「服务配置」，点击左上角的「添加」进入新建服务配置界面，依次填写服务名称，服务描述（选填），蓝图设计（，业务组，点击「提交」

2.  「基本信息」「输入与输出」和「服务部署操作许可」视图配置请参照[概述]

3.  「组件配置」视图：可以看到Kubernetes服务拓扑图以及服务配置中的所有组件，根据kubernetes蓝图，一共有4个组件，分别是Deployment、Service、Container、PersistentVolumeClaim

 + Deployment：点击Deployment名称，进入「基本信息」页面，点击「属性」，可选择副本数量，默认为1，点击「保存」

 + Container：点击Container名称，进入基本信息页面，点击「属性」标签页：

  Container         

+ 镜像源            选择已添加的镜像源，可在kubernetes云平台中添加的Habor、Docker Trusted Registry镜像源，勾选「允许修改」和「仅审批时可修改」。
+   镜像名称          若已选镜像源，则自动过滤该镜像源下的镜像；若未选择镜像源，可输入名称自动创建，勾选「允许修改」和「仅审批时可修改」。
+   镜像标签          选择需要的镜像标签，勾选「允许修改」和「仅审批时可修改」。
+   资源规格 - CPU    输入请求的CPU大小和最大限制的CPU大小，请求的CPU不能大于最大限制，支持申请时改变
+   资源规格 - 内存   输入请求的内存大小和最大限制的内存大小，请求的内存不能大于最大限制，支持申请时改变
+   容器开放端口      例如8080
+   环境变量          例如参数/JRE\_Home的值为/usr

 + Service：点击Service名称，进入基本信息页面，点击「属性」，可配置端口映射，填写下列的信息：

+  服务端口                 服务对外开放的端口，例如8080
+  所依赖的Deployment节点   选择该Service依赖的一个Deployment节点
+  所依赖的Container节点    选择Deployment中的容器节点
+  容器开放端口             选择容器中配置的开放端口
+  主机端口                 选择Node的开放端口，默认范围30000-32767
+  协议                     TCP或者UDP

PersistentVolumeClaim：点击PersistentVolumeClaim名称，进入基本信息页面，点击「属性」：
+  挂载点                  例如/opt/share
+  访问模式                支持ReadWriteOnce，ReadOnlyMany，ReadWriteMany
+  存储类                  Standard
+  空间限额（Gi）          输入空间大小

4.  点击「保存」，返回组件列表界面。点击「验证」，验证成功后，「保存并发布」该服务，Kubernetes虚拟机服务配置并发布成功

## 配置阿里云服务 {#配置阿里云服务}

1.  在左侧导航选择「服务建模」-「服务配置」，点击左上角的「添加」进入新建服务配置界面，依次填写服务名称，服务描述（选填），蓝图设计（选择[创建的阿里云蓝图](https://cloudchef.github.io/doc/AdminDoc/05服务建模/蓝图设计.html#创建阿里云蓝图)，业务组，点击「提交」

2.  「基本信息」「输入与输出」和「服务部署操作许可」视图配置请参照[概述]

3.  「组件配置」视图：可以看到阿里云服务拓扑图以及服务配置中的所有组件：Instance、SecurityGroup

    + Instance：点击Instance名称，进入节点详细设置，共有「基本信息」「网络」「属性」「存储」「安全策略组」「负载均衡」「操作许可」等标签页
4. 「基本信息」页面： 基本信息	展示Instance的类型、类别和名称等基本信息.
 资源池选择策略：1. 自动选择：平台自动按照策略选择资源池 2.	基于资源标签选择：若该服务所使用的蓝图中已有资源便签，默认继承该资源标签，根据标签去选择业务组中匹配该标签的资源池（前提是资源池已设置资源标签），实现将资源部署到特定的资源池中。也可在服务配置选择其他资源标签；勾选「允许修改」和「仅审批时可修改」。，勾选后可在申请时选择  3.	手工指定：可选择为该服务手工指定资源池，若 资源池选择策略选择“手工指定”后，将出现资源池选择项，指定资源池，允许资源池申请时改变
>「Note」若该服务共享给全部业务组，则资源池无法指定，默认强制勾选「允许修改」和「仅审批时可修改」。；若该服务指定给某一业务组，则选择该业务组下的资源池
云主机数量	选择部署的云主机数量，勾选「允许修改」和「仅审批时可修改」。


5. 「网络」页面：

+ 可用区           选择网络的可用区。更改可用区可能会导致虚拟交换机、虚拟机规格、磁盘种类等值的相应改变
+   网络类型         根据资源池中配置的网络类型显示
+   专有网络         若选择专有网络，需选择专有网络
+   虚拟交换机       若选择专有网络，需选择虚拟交换机
+   分配公网IP地址   选中此项，用于安装软件组件或运行脚本

6. 「属性」页面


+ 付费方式	选择预付费或后付费
+ 虚拟机镜像	选择阿里云上的虚拟机镜像
+ 虚拟机规格	选择虚拟机规格
+ 监控方式	选择监控方式，无监控或SSH安装监控代理
+ 安装自动化代理	不安装或SSH安装
+ 应用蓝图自动化部署，服务配置初始化并挂载磁盘，以及某些虚拟机操作（如重置密码、添加新逻辑卷等）将使用此代理；如果未安装，这些功能将受影响。安装自动化代理前提条件：网络类型必须是专有网络（VPC）
+ 用户名	root用户
+ 密码	请输入模板的密码以便在此云主机上安装软件
+ 购买资源时长单位（预付费）	月或周
+ 购买单位时长（预付费）	若购买资源时长单位选择“月”，则可选择1~9，12、24、36、48、60等时长，若购买资源时长单位选择“周”，则可选择1~4周
+ 是否自动续费（预付费）	若勾选自动续费，则根据购买资源时长单位延长相应的周或月

「存储」页面：支持添加或编辑磁盘信息，添加磁盘需填写描述（选填）、选择磁盘种类、填写大小（GB），选择快照

「安全策略组」页面：默认安全策略组且不可编辑

「负载均衡」页面：无

「操作许可」页面：默认继承业务组
「SecurityGroup 」组件：点击SecurityGroup
    名称，进入节点详细设置，共有「基本信息」「属性」两个标签页
「基本信息」页面：可查看SecurityGroup 组件类型、类别、名称

「属性」页面： 使用已有安全组，选择一个已有安全组（资源池中配置的安全组）， 若需要新建安全组，需在「服务建模」-「蓝图设计」- 阿里云蓝图 SecurityGroup 参数选项，取消勾选"使用已有资源"，即可在此新建安全组，安全组名称	填写新建的安全组的名称。管理安全组规则	点击“添加规则”，新建安全组规则
  + 网卡类型：选择私网或公网
  + 规则方向：选择入口或出口
  + 授权策略：选择允许或拒绝
  + 协议类型：选择全部或http、udp、icmp、gre
  + 端口范围：取值范围为1~65535；例如“1/200”、“80/80”
  + 授权类型：地址段访问
  + 授权对象：请谨慎设置授权对象，根据授权策略的不同，0.0.0.0/0代表允许或拒绝所有IP的访问（可点击“教我设置”）
  + 优先级：设置规则优先级

 点击「保存」，返回组件列表界面。点击「验证」，验证成功后，「保存并发布」该服务，阿里云服务配置并发布成功

## 配置Azure服务 {#配置Azure服务}

1.  在左侧导航选择「服务建模」-「服务配置」，点击左上角的「添加」进入新建服务配置界面，依次填写服务名称，服务描述（选填），蓝图设计（选择创建的Azure蓝图），业务组，点击「提交」

2.  「基本信息」「输入与输出」和「服务部署操作许可」视图配置请参照[概述]

3.  「组件配置」视图：可以看到Azure服务拓扑图以及服务配置中的所有组件：Instance、VirtualNetwork、AvailabilitySet、SecurityGroup、LoadBalancer、LoadBalancerRule、BlobContainer

 + Instance：点击Instance名称，进入节点详细设置，共有「基本信息」「云资源配置」「网络」「操作许可」等标签页

 + 「基本信息」页面：显示类型、类别、名称等基本信息。可设置部署的云主机数量，勾选「允许修改」和「仅审批时可修改」

 + 「云资源配置」：包括「云主机配置」、「资源池配置」、「虚拟机模板配置」、「资源规格配置」四部分

1. 云主机配置	云主机名称，默认继承业务组命名规则，勾选「允许修改」和「仅审批时可修改」
2. 资源池配置	  + 资源池选择策略：目前支持 “手工指定”一个资源池，勾选「允许修改」和「仅审批时可修改」
  + 诊断存储账户：选择一个存储账户
  + 磁盘类型：选择一种磁盘类型，如HDD、SSD
3. 虚拟机模板配置	
  + 操作系统名称：选择Windows或Linux操作系统
  + 虚拟机模板：选择windows或Linux操作系统下的Azure虚拟机模板
4. 资源规格配置	  + 资源规格：选择一种系统创建的资源规格
  + 云平台规格：从该资源规格下的Azure云平台资源规格中选择一种


 + 「网络」页面：显示虚拟网络名称、子网、IP分配方式等信息。可勾选「使用公共IP」

 + 「操作许可」页面默认继承业务组配置

<!-- -->

 + VirtualNetwork：点击VirtualNetwork名称，进入节点详细设置，共有「基本信息」「属性」等标签页

<!-- -->

 + 「基本信息」页面：显示类型、类别、名称等信息。

 + 「属性」页面：可选择子网，勾选「允许修改」和「仅审批时可修改」

<!-- -->

 + AvailabilitySet：点击Availability名称，进入节点详细设置，共有「基本信息」「属性」等标签页

<!-- -->

 + 「基本信息」页面：显示类型、类别、名称等信息。

 + 「属性」页面：默认勾选「使用已有资源」。可选择可用性集，勾选「允许修改」和「仅审批时可修改」

<!-- -->

 + SecurityGroup：点击SecurityGroup名称，进入节点详细设置，共有「基本信息」「属性」等标签页

<!-- -->

 + 「基本信息」页面：显示类型、类别、名称等信息。

 + 「属性」页面：默认勾选「使用已有安全组」。可选择安全组，勾选「允许修改」和「仅审批时可修改」选择安全组后，列出详细的入站、出站安全规则。

<!-- -->

 + LoadBalancer：点击LoadBalancer名称，进入节点详细设置，共有「基本信息」「属性」等标签页

<!-- -->

 + 「基本信息」页面：显示类型、类别、名称等信息。

 + 「属性」页面：默认勾选「使用已有资源」。可选择负载均衡器，勾选「允许修改」和「仅审批时可修改」

<!-- -->

 + LoadBalancerRule：点击LoadBalancerRule名称，进入节点详细设置，共有「基本信息」「属性」等标签页

<!-- -->

 + 「基本信息」页面：显示类型、类别、名称等信息。

 + 「属性」页面：输入负载均衡规则名称、选择前端IP地址和通信协议（TCP/UDP）、输入端口和后端端口。上述项目均勾选「允许修改」和「仅审批时可修改」。。

<!-- -->

 + BlobContainer：点击BlobContainer名称，进入节点详细设置，共有「基本信息」「属性」等标签页

<!-- -->

 + 「基本信息」页面：显示类型、类别、名称等信息

 + 「属性」页面：基于"资源池选择策略（手工指定/自动选择/基于资源标签选择）"选择资源池，勾选「允许修改」和「仅审批时可修改」。。输入BlobContainer名称，勾选「允许修改」和「仅审批时可修改」。。选择一个存储账户，并选择公共访问级别（仅匿名读取访问Blob/匿名读取访问容器和Blob）

4.  点击「保存」，返回组件列表界面。点击「验证」，验证成功后，「保存并发布」该服务，Azure服务配置并发布成功

## 配置AWS服务 {#配置AWS服务}

1.  在左侧导航选择「服务建模」-「服务配置」，点击左上角的「添加」进入新建服务配置界面，依次填写服务名称，服务描述（选填），蓝图设计（选择[AWS蓝图](https://cloudchef.github.io/doc/AdminDoc/05服务建模/蓝图设计.html#创建AWS蓝图)，业务组，点击「提交」

2.  「基本信息」「输入与输出」和「服务部署操作许可」视图配置请参照[概述]

3.  「组件配置」视图：可以看到AWS服务拓扑图以及服务配置中的所有组件：Instance、SecurityGroup

 + Instance：点击Instance名称，进入节点详细设置，共有「基本信息」「云资源配置」「操作许可」等标签页

<!-- -->

 + 「基本信息」页面：

+ 基本信息     展示Instance的类型、名称等基本信息
+ 云主机数量   默认云主机数量为1，可更改或选择"勾选「允许修改」和「仅审批时可修改」。"

 + 「云资源配置」页面：


1. 云主机配置
云主机名称	没有定义时默认继承业务组命名规则，支持勾选「允许修改」和「仅审批时可修改」。
2. 资源池配置
资源池选择策略	  + 手工指定：手工指定资源池
「Note」若该服务共享给全部业务组，则资源池无法指定，默认强制勾选「允许修改」和「仅审批时可修改」。；若该服务指定给某一业务组，则选择该业务组下的资源池
资源池	选择资源池，将根据蓝图类型进行过滤
可用区	选择可用区，将根据所选资源池中可用区进行过滤
子网	选择子网，将根据所选资源池中配置的子网进行过滤
3. 虚拟机模板配置
操作系统	选择Linux操作系统
虚拟机模板	选择该操作系统下的青云虚拟机模板
4. 计算规格配置
资源规格	选择在「基础设施」-「计算规格」中自定义的规格
云平台规格	选择在「基础设施」-「计算规格」中自定义的云平台规格，将根据所选的资源规格进行过滤
公网配置
分配公网IP地址	可选是否分配公网IP地址


 + 「操作许可」页面：在此可启用虚拟机的各项操作，以及配置所需的审批流程。对于每个操作，可针对不同的角色，配置不同的规则和审批流程。默认选填继承业务组配置，可增删，可对操作列表进行角色筛选

<!-- -->

 + SecurityGroup：点击SecurityGroup名称，进入节点详细设置，共有「基本信息」「属性」等标签页

<!-- -->

 + 「基本信息」页面：显示类型和名称

 + 「属性」页面：

默认勾选「使用已有安全组」，选择已有安全组，选择后将列出该安全组的规则，勾选「允许修改」和「仅审批时可修改」。
 若不勾选「使用已有安全组」即新建安全组，填写安全组名称、描述，名称勾选「允许修改」和「仅审批时可修改」。，点击添加规则，配置相关的安全组规则

4.  点击「保存」，返回组件列表界面。点击「验证」，验证成功后，「保存并发布」该服务，AWS服务配置并发布成功

## 配置青云服务 {#配置青云服务}

1.  在左侧导航选择「服务建模」-「服务配置」，点击左上角的「添加」进入新建服务配置界面，依次填写服务名称，服务描述（选填），蓝图设计（选择[青云蓝图](https://cloudchef.github.io/doc/AdminDoc/05服务建模/蓝图设计.html#创建青云蓝图)，业务组，点击「提交」

2.  「基本信息」「输入与输出」和「服务部署操作许可」视图配置请参照[概述]

3.  「组件配置」视图：可以看到青云服务拓扑图以及服务配置中的所有组件：WindowsInstance、SecurityGroup
  WindowsInstance：点击WindowsInstance名称，进入节点详细设置，共有「基本信息」「云资源配置」「操作许可」等标签页。
 + 「基本信息」页面： 基本信息     展示WindowsInstance的类型、名称等基本信息。   云主机数量   默认云主机数量为1，可更改或选择"勾选「允许修改」和「仅审批时可修改」。"

 + 「云资源配置」页面： 云主机配置云主机名称，	没有定义时默认继承业务组命名规则，支持勾选「允许修改」和「仅审批时可修改」。 资源池配置，资源池选择策略；	手工指定：手工指定资源池。选择资源池，将根据蓝图类型进行过滤。	选择子网，将根据所选资源池中配置的子网进行过滤。

>「Note」若该服务共享给全部业务组，则资源池无法指定，默认强制勾选「允许修改」和「仅审批时可修改」。；若该服务指定给某一业务组，则选择该业务组下的资源池

+ 虚拟机模板配置：操作系统	选择Linux操作系统；虚拟机模板	选择该操作系统下的青云虚拟机模板
+  计算规格配置：资源规格	选择在「基础设施」-「计算规格」中自定义的规格；云平台规格	选择在「基础设施」-「计算规格」中自定义的云平台规格，将根据所选的资源规格进行过滤；公网配置分配公网IP地址	可选是否分配公网IP地址。	没有定义时默认继承业务组命名规则，支持勾选「允许修改」和「仅审批时可修改」。	手工指定：手工指定资源池
>「Note」若该服务共享给全部业务组，则资源池无法指定，默认强制勾选「允许修改」和「仅审批时可修改」。；若该服务指定给某一业务组，则选择该业务组下的资源池

+ 「操作许可」页面：在此可启用虚拟机的各项操作，以及配置所需的审批流程。对于每个操作，可针对不同的角色，配置不同的规则和审批流程。默认选填继承业务组配置，可增删，可对操作列表进行角色筛选

<!-- -->

 + SecurityGroup：点击SecurityGroup名称，进入节点详细设置，共有「基本信息」「属性」等标签页

<!-- -->

 + 「基本信息」页面：显示类型和名称

 + 「属性」页面：

 默认勾选「使用已有安全组」，选择已有安全组，选择后将列出该安全组的规则，勾选「允许修改」和「仅审批时可修改」。 若不勾选「使用已有安全组」即新建安全组，填写安全组名称，点击添加规则，配置相关的防火墙规则

6.  点击「保存」，返回组件列表界面。点击「验证」，验证成功后，「保存并发布」该服务，青云服务配置并发布成功

## 配置Hyper-V服务 {#配置Hyper-V服务}

1.  在左侧导航点击「服务建模」-「服务配置」，点击左上角的「添加」进入新建服务配置界面，依次填写服务名称，服务描述（选填），蓝图设计（选择Hyper-V单节点蓝图），业务组，点击「提交」

2.  「基本信息」页面：

+  业务组                   部署所属业务组
+   服务部署名称             部署名称（若业务组已设定服务部署命名规则，服务部署名称将按照规则自动生成，无需填写）
+   Logo图像                 上传图像，在服务目录展示时更美观
+   描述                     部署描述
+   服务分组                 内置三者类型：工单服务、数据库、基础设施，支持自定义（关于服务分组的详细介绍请参考：[服务分组](https://cloudchef.github.io/doc/AdminDoc/05服务建模/服务分组.html)
+   顺序                     指定服务目录中的排列顺序，数值小的排列靠前
+   服务状态                 实时展示服务状态，如：未发布
+   服务部署租用时间（日）   租用时间，租用时间到后，部署里的所有云主机会停机并归档
+   服务部署保留时间（日）   保留时间，保留时间到后，部署会被卸除
+   允许申请时添加软件       勾选上则允许服务申请时添加软件
+   审批流程                 可选择无审批流程、默认审批流程和自定义的审批流程

3.  「流程配置」视图：可以选择流程类型，查看流程信息、流程图、流程步骤

4.  「组件配置」视图：可以看到Hyper-V服务拓扑图以及服所有组件：WindowsInstance和NetworkAdapter，可进行组件节点详细设计。其中下面为您详细介绍WindowsInstance云资源配置：
 +  资源池配置                  资源池选择策略：选择手工指定；资源池：选择Hyper-V资源池，勾选申请时可见则服务申请时显示，勾选申请时可修改则在服务申请时可以修改资源池。
 +  计算规格                    计算规格：选择微型（1C1G）; 勾选申请时可见则服务申请时显示，勾选申请时可修改则在服务申请时可以修改计算规格。

5.  「输入与输出配置请参照[概述]

6.  「服务部署操作许可」视图：在此可启用服务部署管理中的各项操作，以及配置所需的审批流程。对于每个操作，可针对不同的角色，配置不同的规则和审批流程。默认继承业务组配置，可增删，可对操作列表进行角色筛选

7.  点击「保存」，返回组件列表界面。点击「验证」，验证成功后，「保存并发布」该服务，Hyper-V虚拟机服务配置并发布成功

## 配置F5与OpenStack组合服务  {#配置F5与OpenStack组合服务}

1.  在左侧导航点击「服务建模」-「服务配置」，点击左上角的「添加」进入新建服务配置界面，依次填写服务名称，服务描述（选填），蓝图设计（选择F5与OpenStack组合蓝图），点击「提交」。

2.  「基本信息」页面：
    除了服务名称自定义填写，其余与配置vSphere单节点服务基本信息页面一致。

3.  「流程配置」视图：可以选择流程类型，查看流程信息、流程图、流程步骤

4.  「组件配置」视图：可以看到OpenStack
    服务拓扑图以及所有组件：Server、Network，F5服务所有组件：Virtual
    Server、Pool以及SNAT Pool

OpenStack的Server和Network组件，配置参考：[配置OpenStack单节点服务](https://cloudchef.github.io/doc/AdminDoc/05服务建模/蓝图设计.html#创建OpenStack单节点蓝图)

 F5服务的组件配置：

 1. Pool： 进入「属性」视图，选择资源池选择策略（手工指定），选择资源池（F5BIG-IP资源池），勾选允许修改 则在服务申请时允许修改，选择负载均衡方式；SNAT Pool：
 2. 进入「属性」视图，选择资源池选择策略（手工指定），选择资源池（F5BIG-IP资源池），勾选允许修改 则在服务申请时允许修改，定义基础属性 ：勾选使用已有资源     选择已有的SNATPool，例如：F5-SNATPool;不勾选使用已有资源   定义IP名称和IP地址，例如：

 + Virtual Server：
    进入「属性」视图，选择资源池选择策略（手工指定），选择资源池（F5 BIG-IP资源池），勾选允许修改
    则在服务申请时允许修改，IP分配方式选择（IP池）

5.  点击「保存」，返回组件列表界面。点击「验证」，验证成功后，「保存并发布」该服务，F5服务配置并发布成功


# 配置手工工单服务{#配置手工工单服务}


管理员可以将设计好的工单发布为服务，管理员可以将服务与企业内部的流程集成之后发布到服务目录。服务项主要功能有：

服务与指定服务团队关联，服务请求由团队关联的用户来处理，即指定服务团队，发布工单到不同部门服务与流程配置相关联，平台支持管员自定义服务流程，同时支持使用内置的服务流程

## 添加手工工单服务配置 {#添加手工工单服务配置 .afff6}

您可以根据下面步骤添加手工工单服务配置：

1.  在左边导航栏选择「服务建模」-「服务配置」，点击「添加」

 填写服务名称、服务描述（选填）、选择业务组，服务类型为手工工单服务时，增选一项服务流程，点击「提交」，进入服务配置「概况」页面

 + 在「基本信息」标签页填入下列信息：名称，描述，logo图像，服务分组，顺序

 + 在「审批配置」页面指定审批流程，例如，申请创建新项目的手工工单服务，您可以指定租户管理员审批的审批流程。
 + 在「流程配置」页面指定服务处理阶段需要指派合适的人去完成任务，指定服务确认关闭阶段需要申请人判断问题是否得到解决，配置处理人的详细信息，处理人配置包括以下几种类型：
    + 服务团队，再选择具体的服务团队名称，服务团队内部工单分配方式可选 成员认领/随机分配
    + 角色，选择一种类型角色，例如所有的租户管理员，其内部工单分配方式也可选 成员认领/随机分配
    + 用户，指定具体用户处理工单
    + 申请人，指定具体申请人处理工单

 + 在「表单配置」页面指定创建的表单，例如，申请创建新项目的手工工单服务，您可选择创建项目的表单。

2. 点击保存按钮，服务将被保存不发布，点击保存并发布按钮，服务将被发布到服务目录页面。

## 编辑、删除手工工单服务配置 {#编辑删除手工工单服务配置 .afff6}

在左侧导航栏点击「服务建模」-「服务配置」，选择一个服务配置，点击「编辑」按钮，输入需要修改的内容，点击「保存」。

在左侧导航栏点击「服务建模」-「服务配置」，选择一个服务配置，点击「删除」按钮，提示删除服务配置成功。

## 发布、取消发布手工工单服务配置 {#发布取消发布手工工单服务配置 .afff6}
   
在左侧导航栏点击「服务建模」-「服务配置」，选择一个服务配置，点击「发布」按钮，提示发布成功。

在左侧导航栏点击「服务建模」-「服务配置」，选择一个服务配置，点击「取消发布」按钮，提示取消发布服务配置成功。





# 配置标准任务
在左侧导航点击「服务建模」-「服务配置」，点击左上角的「添加」进入新建服务配置界面，依次填写服务名称，服务描述（选填），选择业务组，服务类型选择执行任务服务，流程选择标准任务服务流程，点击「提交」。
「概况」页面：服务名称、描述自定义填写，选择服务可供申请的角色、服务分组、服务卡片排序、状态。

「任务配置」页面：点击添加按钮，与流水线添加任务的界面一致。详情请参考：[配置任务](https://cloudchef.github.io/doc/AdminDoc/11作业管理/#配置任务)。

「审批配置」页面：选择审批流程，例如：业务组管理员审批、租户管理审批、并行审批等其他自定义审批流程。

「表单配置」页面：根据需求自定义绑定表单，例如：上传附件、创建IP池、创建项目、添加AD用户等其他自定义表单。

「流程配置」页面：可以选择流程类型，查看流程信息、流程图、流程步骤


# 编辑服务配置

在左侧导航选择「服务建模」-「服务配置」，在服务配置列表界面，点击服务配置名称，进入「基本信息」页面，可编辑相应的参数，点击」保存」。

# 取消发布服务配置

在左侧导航选择「服务建模」-「服务配置」，在服务配置列表界面，选中某服务配置，若该服务配置状态为"已发布"，则「取消发布」操作可用，点击后确定，取消发布成功。在服务配置列表界面该服务配置状态更改为"未发布"，未发布服务配置将不能在服务目录界面显示且不能被申请。

# 卸除服务配置

在左侧导航选择「服务建模」-「服务配置」，在服务配置列表界面，选中某服务配置，点击「卸除服务部署」，确定后卸除服务配置成功。
