**服务模型**

在SmartCMP中，服务分为两种类型：

+ 云资源蓝图服务：是指各云平台资源的申请和自动化部署。这些服务可以是基础设施服务（例如虚拟机，防火墙，DNS等），应用服务（例如数据库，或是包含网络负载均衡、Web组件和数据库在内的整体应用等）等。
+ 手工工单服务：即非标准化、需要人工进行介入和支持的服务，包括服务请求，事件处理等等。例如，用户忘记密码需要进行重置，或是提交一个开通邮箱或账户的请求，或是遇到IT服务的问题需要解决（服务器、打印机或网络不能访问等等）。用户可通过服务目录发起工单请求服务，服务团队收到请求，进行工单处理。

下图描述了组件、蓝图、服务和部署之间的逻辑联系。组件包括软件组件和基础架构组件，软件架构师构建应用的拓扑结构图并为服务配置资源和参数，将服务卡片发布到服务目录。业务组成员在服务目录中根据实际需求进行自助申请，服务按照策略和规范自动组合，完成自动化部署交付。

![云服务模型示例](../../picture/foundationConcepts/云服务模型.png)
# 组件

组件是构成蓝图的基本单元。SmartCMP中的组件包含两种类型：

+ 基础设施组件：包括计算组件（例如，虚拟机、容器等），网络组件（例如，负载均衡、安全组、防火墙等），存储组件（例如，磁盘、对象存储等）。这些组件是SmartCMP内置的，在蓝图设计时候可以进行选择。
+ 软件组件：用于应用软件的安装，包括中间件、关系型数据库、非关系型数据库等等。您可以将配置属性标准化，并使用脚本来指定在软件部署的过程中如何安装、配置、卸载或更新组件（您也可以自定义您所需要的其他操作）。软件架构师可以通过软件组件管理界面创建自定义的组件，更新已有组件，或者删除已经下架的组件。在蓝图设计时，软件组件可与基础设施组件一起使用。

# 蓝图

蓝图是包含计算、存储、网络、软件等资源在内的整体应用的完整规范，用于确定各种资源的的属性与依赖关系、工作流和执行策略。您可以通过可视化画布进行蓝图设计，将一个或多个组件进行组合，从而创建标准化的服务框架。蓝图发布之后，可用于创建服务。

蓝图可以是多种形式，例如，一个蓝图可以包含：

+ 一个网络组件和一个虚拟机组件
+ 一个防火墙组件，或是一个公有云关系型数据库组件
+ 多层次的应用架构，例如：网络负载均衡，Web应用，和数据库
+ 多个云平台组件的混合编排，例如Web应用部署在阿里云，数据库在vSphere私有云；或是Web应用在Kubernetes容器，数据库在OpenStack私有云。



# 流程

流程定义了自动化过程当中每一步的活动或任务执行的顺序与策略。

SmartCMP中的流程分为以下三种类型。每种类型都包含内置的流程，可以直接使用。这些内置的流程不能修改或删除。您也可以通过可视化的流程设计器，自定义需要的流程。

+ 云资源蓝图服务：定义云资源自动化部署的流程，包括标准云服务部署内置流程。
+ 手工工单服务：定义工单服务每一步的任务和流转方式，包括标准手工工单，标准事件管理等内置流程。
+ 审批流程：用于控制用户申请服务、或针对云资源进行运维操作时，是否需要获得组织中某人或者某些人的批准才能进行。

请注意，在5.1之前版本或从老版本升级上来的SmartCMP中，提供了审批流程配置菜单，用于兼容旧版本中的审批流程。但该功能会在未来关闭，建议您使用流程配置来创建和管理审批流程。



# 表单

当用户请求服务目录中的服务时，您创建和发布的每个服务都会显示一个表单。在创建或配置每个服务时，您可以使用默认表单；如果您需要修改或添加额外的字段信息供用户在申请时候填写，您可以通过表单设计器，自定义表单。

# 服务分组

服务分组用于将不同的服务组织到相关类型中，使用户可以更方便地浏览所需的服务。例如：基础设施服务，数据库服务，工单服务等等。您可以根据需要创建新的分组，将需要发布的服务进行归类展示。



# 服务发布

租户管理员或基础设施管理员可将已经发布的蓝图和流程，根据不同的组织或部门需求进行配置，发布成为服务目录中的服务。一个服务可以发布到某个业务组，这样只有该业务组的成员才能进行申请；也可以发布到所有业务组，共享给所有成员进行申请。

在服务配置的过程中：

+ 针对云资源部署服务，您可以指定部署的完整规范，例如虚拟机配置（所需的虚拟机模板，计算规格大小，磁盘配置等等），租期，操作许可，审批流程，服务流程，自定义表单等等；
+ 针对工单服务，您可以指定每一步任务处理的服务团队，审批流程，服务流程，自定义表单等等。

## 服务的租期

租期包括租用时间，保留时间以及回收站回收时间：

+ 当租用时间到期之后，服务部署中的所有计算资源将会被关机；
+ 当保留时间到期之后，该服务部署将会被放置到回收站；
+ 在回收站中，您可以还原，或进行手动删除（将从云平台中彻底释放这些资源）。如不进行任何操作，资源将在回收时间到期后，自动删除（将从云平台中彻底释放这些资源）。

## 服务的审批流程

审批流程可在业务组和服务配置处分别进行设置：

  + 业务组配置的审批流程将对该业务组所有的服务生效；
  + 如果某个服务单独配置了审批流程，该流程将生效，不再使用业务组配置的审批流程；如果服务没有配置，则使用业务组配置的审批流程。

# 服务部署

用户申请云资源服务之后，经过审批（如果配置了审批流程），SmartCMP将根据服务配置的策略与规范自动化进行部署，完成之后，交付给用户进行使用。

服务部署是指用户所申请服务包含的的所有云资源，例如一台虚拟机，一个数据库，或是一个多层次架构的应用环境。用户可在配置的服务租期内，使用该服务部署的所有资源，并能够根据管理员配置的操作许可，自助进行运维或变更操作。

## 服务部署和云资源的命名规则

您可以为每个业务组配置命名规则，来规范服务部署及其所包含云资源的名称，包括服务部署名称、云主机显示名称、以及Windows或Linux操作系统主机名（Hostname）。为了保证命名的唯一性，您可以在规则中加入命名后缀。

命名后缀可以是自定义长度的数字序列或者自定义长度的随机字符串。您可以为数字序列指定初始化序列号，例如，您可以创建一个长度为3、初始化序列号为1的命名后缀，如果指定业务组名加上此后缀为云主机名称的命名规则，则针对Dev业务组部署出来的云主机名称将依次为Dev001、Dev002等。

## 服务部署和云资源的操作许可

操作许可指授权给用户可以针对服务部署或是云资源执行的变更或运维操作。您可以禁用或启用某些操作，以及针对启用的操作设置审批流程。操作许可分为两种类型：

+ 服务部署操作针是指针对服务部署级别的操作，包括延长服务部署的租期，更改服务部署所属的业务组、项目、所有者等等；
+ 云资源操作许针对云主机或其他云资源，包括开关机，远程连接，添加磁盘，迁移等等。

可在业务组和服务配置处分别进行设置操作许可：

  + 针对每个业务组配置的操作许可，将对该业务组所有的服务部署和云资源生效；
  + 每个服务默认继承业务组的操作许可；您也可以单独为该服务配置操作许可，覆盖业务组上的设置。

